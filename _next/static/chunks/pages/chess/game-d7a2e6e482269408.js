(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[16],{3454:function(e,t,i){"use strict";var s,o;e.exports=(null==(s=i.g.process)?void 0:s.env)&&"object"==typeof(null==(o=i.g.process)?void 0:o.env)?i.g.process:i(7663)},1560:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chess/game",function(){return i(749)}])},749:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return eG}});var s=i(5893),o=i(7294);let r={start:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",empty:"8/8/8/8/8/8/8/8"};class n{setFen(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r.empty;"start"===t?(console.warn("setting the position with the strings 'start' or 'empty' is deprecated, use FEN.start or FEN.empty","used:",t),e=r.start):"empty"===t||void 0===t?(console.warn("setting the position with the strings 'start' or 'empty' is deprecated, use FEN.start or FEN.empty","used:",t),e=r.empty):e=t;let i=e.replace(/^\s*/,"").replace(/\s*$/,"").split(/\/|\s/);for(let e=0;e<8;e++){let t=i[7-e].replace(/\d/g,e=>{let t=parseInt(e),i="";for(let e=0;e<t;e++)i+="-";return i});for(let i=0;i<8;i++){let s=t.substring(i,i+1),o=null;"-"!==s&&(o=s.toUpperCase()===s?"w".concat(s.toLowerCase()):"b".concat(s)),this.squares[8*e+i]=o}}}getFen(){let e=Array(8).fill("");for(let t=0;t<8;t++){let i=0;for(let s=0;s<8;s++){let o=this.squares[8*t+s];if(o){i>0&&(e[7-t]+=i,i=0);let s=o.substring(0,1),r=o.substring(1,2);"w"===s?e[7-t]+=r.toUpperCase():e[7-t]+=r}else i++}i>0&&(e[7-t]+=i,i=0)}return e.join("/")}getPieces(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["k","q","r","b","n","p"],t=[],i=(t,i)=>e.indexOf(t.name)-e.indexOf(i.name);for(let e=0;e<64;e++){let i=this.squares[e];i&&t.push({name:i.charAt(1),color:i.charAt(0),position:n.indexToSquare(e)})}return e&&t.sort(i),t}movePiece(e,t){if(!this.squares[n.squareToIndex(e)]){console.warn("no piece on",e);return}this.squares[n.squareToIndex(t)]=this.squares[n.squareToIndex(e)],this.squares[n.squareToIndex(e)]=void 0}setPiece(e,t){this.squares[n.squareToIndex(e)]=t}getPiece(e){return this.squares[n.squareToIndex(e)]}static squareToIndex(e){let t=e.substring(0,1).charCodeAt(0)-97,i=e.substring(1,2)-1;return 8*i+t}static indexToSquare(e){let t=String.fromCharCode(e%8+97);return t+(Math.floor(e/8)+1)}clone(){let e=new n;return e.squares=this.squares.slice(0),e}constructor(e){this.squares=Array(64).fill(null),this.setFen(e)}}class a{invokeExtensionPoints(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.extensionPoints[e],s=Object.assign({},t);s.extensionPoint=e;let o=!0;if(i)for(let e of i)!1===e(s)&&(o=!1);return o}constructor(){this.position=new n,this.orientation=void 0,this.markers=[],this.inputWhiteEnabled=!1,this.inputBlackEnabled=!1,this.inputEnabled=!1,this.squareSelectEnabled=!1,this.extensionPoints={},this.moveInputProcess=Promise.resolve()}}let h="http://www.w3.org/2000/svg";class l{static createSvg(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=document.createElementNS(h,"svg");return e&&(t.setAttribute("width","100%"),t.setAttribute("height","100%"),e.appendChild(t)),t}static addElement(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,o=document.createElementNS(h,t);for(let e in"use"===t&&(i["xlink:href"]=i.href),i)if(i.hasOwnProperty(e)){if(-1!==e.indexOf(":")){let t=e.split(":");o.setAttributeNS("http://www.w3.org/1999/"+t[0],t[1],i[e])}else o.setAttribute(e,i[e])}return void 0!==s?e.appendChild(o):e.insertBefore(o,s),o}static removeElement(e){e.parentNode?e.parentNode.removeChild(e):console.warn(e,"without parentNode")}}let c={positionChanged:"positionChanged",boardChanged:"boardChanged",moveInputToggled:"moveInputToggled",moveInput:"moveInput",redrawBoard:"redrawBoard",animation:"animation",destroy:"destroy"};class u{registerExtensionPoint(e,t){this.chessboard.state.extensionPoints[e]||(this.chessboard.state.extensionPoints[e]=[]),this.chessboard.state.extensionPoints[e].push(t)}registerMethod(e,t){if(this.chessboard[e])log.error("method",e,"already exists");else{var i=this;this.chessboard[e]=function(){for(var e=arguments.length,s=Array(e),o=0;o<e;o++)s[o]=arguments[o];return t.apply(i,s)}}}constructor(e,t){this.chessboard=e,this.props=t}}let d={start:"start",frame:"frame",end:"end"};class p{async enqueue(e){return new Promise((t,i)=>{this.queue.push({promise:e,resolve:t,reject:i}),this.dequeue()})}dequeue(){if(this.workingOnPromise)return;if(this.stop){this.queue=[],this.stop=!1;return}let e=this.queue.shift();if(e){try{this.workingOnPromise=!0,e.promise().then(t=>{this.workingOnPromise=!1,e.resolve(t),this.dequeue()}).catch(t=>{this.workingOnPromise=!1,e.reject(t),this.dequeue()})}catch(t){this.workingOnPromise=!1,e.reject(t),this.dequeue()}return!0}}destroy(){this.stop=!0}constructor(){this.queue=[],this.workingOnPromise=!1,this.stop=!1}}let g={move:0,appear:1,disappear:2};class v{static seekChanges(e,t){let i=[],s=[],o=[];for(let o=0;o<64;o++){let r=e[o],n=t[o];n!==r&&(n&&i.push({piece:n,index:o}),r&&s.push({piece:r,index:o}))}return i.forEach(e=>{let t,i=8;s.forEach(s=>{if(e.piece===s.piece){let o=v.squareDistance(e.index,s.index);o<i&&(t=s,i=o)}}),t?(s.splice(s.indexOf(t),1),o.push({type:g.move,piece:e.piece,atIndex:t.index,toIndex:e.index})):o.push({type:g.appear,piece:e.piece,atIndex:e.index})}),s.forEach(e=>{o.push({type:g.disappear,piece:e.piece,atIndex:e.index})}),o}createAnimation(e,t){let i=v.seekChanges(e,t),s=[];return i.forEach(e=>{let t={type:e.type};switch(e.type){case g.move:t.element=this.view.getPieceElement(n.indexToSquare(e.atIndex)),t.element.parentNode.appendChild(t.element),t.atPoint=this.view.indexToPoint(e.atIndex),t.toPoint=this.view.indexToPoint(e.toIndex);break;case g.appear:t.element=this.view.drawPieceOnSquare(n.indexToSquare(e.atIndex),e.piece),t.element.style.opacity=0;break;case g.disappear:t.element=this.view.getPieceElement(n.indexToSquare(e.atIndex))}s.push(t)}),s}animationStep(e){if(!this.view||!this.view.chessboard.state)return;this.startTime||(this.startTime=e,this.view.chessboard.state.invokeExtensionPoints(c.animation,{type:d.start}));let t=e-this.startTime;if(t<=this.duration)this.frameHandle=requestAnimationFrame(this.animationStep.bind(this));else{cancelAnimationFrame(this.frameHandle),this.animatedElements.forEach(e=>{e.type===g.disappear&&l.removeElement(e.element)}),this.view.chessboard.state.invokeExtensionPoints(c.animation,{type:d.end}),this.callback();return}let i=Math.min(1,t/this.duration),s=i<.5?2*i*i:-1+(4-2*i)*i;(isNaN(s)||s>.99)&&(s=1),this.animatedElements.forEach(e=>{if(e.element)switch(e.type){case g.move:e.element.transform.baseVal.removeItem(0);let t=this.view.svg.createSVGTransform();t.setTranslate(e.atPoint.x+(e.toPoint.x-e.atPoint.x)*s,e.atPoint.y+(e.toPoint.y-e.atPoint.y)*s),e.element.transform.baseVal.appendItem(t);break;case g.appear:e.element.style.opacity=Math.round(100*s)/100;break;case g.disappear:e.element.style.opacity=Math.round((1-s)*100)/100}else console.warn("animatedItem has no element",e)}),this.view.chessboard.state.invokeExtensionPoints(c.animation,{type:d.frame,progress:s})}static squareDistance(e,t){return Math.max(Math.abs(Math.floor(t/8)-Math.floor(e/8)),Math.abs(t%8-e%8))}constructor(e,t,i,s,o){this.view=e,t&&i?(this.animatedElements=this.createAnimation(t.squares,i.squares),this.duration=s,this.callback=o,this.frameHandle=requestAnimationFrame(this.animationStep.bind(this))):console.error("fromPosition",t,"toPosition",i)}}class b extends p{async enqueuePositionChange(e,t,i){return e.getFen()===t.getFen()?Promise.resolve():super.enqueue(()=>new Promise(s=>{let o=i?this.chessboard.props.style.animationDuration:0;this.queue.length>0&&(o/=1+Math.pow(this.queue.length/5,2)),new v(this.chessboard.view,e,t,i?o:0,()=>{this.chessboard.view&&this.chessboard.view.redrawPieces(t.squares),s()})}))}async enqueueTurnBoard(e,t,i){return super.enqueue(()=>new Promise(s=>{let o=new n(r.empty),a=i?this.chessboard.props.style.animationDuration:0;this.queue.length>0&&(a/=1+Math.pow(this.queue.length/5,2)),new v(this.chessboard.view,e,o,i?a:0,()=>{this.chessboard.state.orientation=t,this.chessboard.view.redrawBoard(),this.chessboard.view.redrawPieces(o.squares),new v(this.chessboard.view,o,e,i?a:0,()=>{this.chessboard.view.redrawPieces(e.squares),s()})})}))}constructor(e){super(),this.chessboard=e}}class m{static delegate(e,t,i,s){let o=function(e){let t=e.target;for(;t&&t!==this;)t.matches(i)&&s.call(t,e),t=t.parentNode};return e.addEventListener(t,o),{remove:function(){e.removeEventListener(t,o)}}}static mergeObjects(e,t){if(!(e&&"object"==typeof e)||!(t&&"object"==typeof t))return t;for(let i of Object.keys(t))t[i]instanceof Object&&Object.assign(t[i],m.mergeObjects(e[i],t[i]));return Object.assign(e||{},t),e}static createDomElement(e){let t=document.createElement("template");return t.innerHTML=e.trim(),t.content.firstChild}static createTask(){let e,t;let i=new Promise(function(i,s){e=i,t=s});return i.resolve=e,i.reject=t,i}}let f={waitForInputStart:0,pieceClickedThreshold:1,clickTo:2,secondClickThreshold:3,dragTo:4,clickDragTo:5,moveDone:6,reset:7},P={secondClick:"secondClick",secondaryClick:"secondaryClick",movedOutOfBoard:"movedOutOfBoard",draggedBack:"draggedBack",clickedAnotherPiece:"clickedAnotherPiece"};class C{setMoveInputState(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,i=this.moveInputState;switch(this.moveInputState=e,e){case f.waitForInputStart:break;case f.pieceClickedThreshold:if(f.waitForInputStart!==i&&f.clickTo!==i)throw Error("moveInputState");if(this.pointerMoveListener&&(removeEventListener(this.pointerMoveListener.type,this.pointerMoveListener),this.pointerMoveListener=void 0),this.pointerUpListener&&(removeEventListener(this.pointerUpListener.type,this.pointerUpListener),this.pointerUpListener=void 0),this.fromSquare=t.square,this.toSquare=void 0,this.movedPiece=t.piece,this.startPoint=t.point,this.pointerMoveListener||this.pointerUpListener)throw Error("94ad0c");if("mousedown"===t.type)this.pointerMoveListener=this.onPointerMove.bind(this),this.pointerMoveListener.type="mousemove",addEventListener("mousemove",this.pointerMoveListener),this.pointerUpListener=this.onPointerUp.bind(this),this.pointerUpListener.type="mouseup",addEventListener("mouseup",this.pointerUpListener);else if("touchstart"===t.type)this.pointerMoveListener=this.onPointerMove.bind(this),this.pointerMoveListener.type="touchmove",addEventListener("touchmove",this.pointerMoveListener),this.pointerUpListener=this.onPointerUp.bind(this),this.pointerUpListener.type="touchend",addEventListener("touchend",this.pointerUpListener);else throw Error("4b74af");this.contextMenuListener||(this.contextMenuListener=this.onContextMenu.bind(this),this.chessboard.view.svg.addEventListener("contextmenu",this.contextMenuListener));break;case f.clickTo:this.draggablePiece&&(l.removeElement(this.draggablePiece),this.draggablePiece=void 0),i===f.dragTo&&this.view.setPieceVisibility(t.square,!0);break;case f.secondClickThreshold:if(f.clickTo!==i)throw Error("moveInputState");this.startPoint=t.point;break;case f.dragTo:if(f.pieceClickedThreshold!==i)throw Error("moveInputState");this.view.chessboard.state.inputEnabled&&(this.view.setPieceVisibility(t.square,!1),this.createDraggablePiece(t.piece));break;case f.clickDragTo:if(f.secondClickThreshold!==i)throw Error("moveInputState");this.view.chessboard.state.inputEnabled&&(this.view.setPieceVisibility(t.square,!1),this.createDraggablePiece(t.piece));break;case f.moveDone:if(-1===[f.dragTo,f.clickTo,f.clickDragTo].indexOf(i))throw Error("moveInputState");this.toSquare=t.square,this.toSquare&&this.validateMoveInputCallback(this.fromSquare,this.toSquare)?i===f.clickTo?this.chessboard.movePiece(this.fromSquare,this.toSquare,!0).then(()=>{this.setMoveInputState(f.reset)}):this.chessboard.movePiece(this.fromSquare,this.toSquare,!1).then(()=>{this.view.setPieceVisibility(this.toSquare,!0),this.setMoveInputState(f.reset)}):(this.view.setPieceVisibility(this.fromSquare,!0),this.setMoveInputState(f.reset));break;case f.reset:this.fromSquare&&!this.toSquare&&this.movedPiece&&this.chessboard.state.position.setPiece(this.fromSquare,this.movedPiece),this.fromSquare=void 0,this.toSquare=void 0,this.movedPiece=void 0,this.draggablePiece&&(l.removeElement(this.draggablePiece),this.draggablePiece=void 0),this.pointerMoveListener&&(removeEventListener(this.pointerMoveListener.type,this.pointerMoveListener),this.pointerMoveListener=void 0),this.pointerUpListener&&(removeEventListener(this.pointerUpListener.type,this.pointerUpListener),this.pointerUpListener=void 0),this.contextMenuListener&&(removeEventListener("contextmenu",this.contextMenuListener),this.contextMenuListener=void 0),this.setMoveInputState(f.waitForInputStart);break;default:throw Error("260b09: moveInputState ".concat(e))}}createDraggablePiece(e){if(this.draggablePiece)throw Error("59c195");this.draggablePiece=l.createSvg(document.body),this.draggablePiece.classList.add("cm-chessboard-draggable-piece"),this.draggablePiece.setAttribute("width",this.view.squareWidth),this.draggablePiece.setAttribute("height",this.view.squareHeight),this.draggablePiece.setAttribute("style","pointer-events: none"),this.draggablePiece.name=e;let t=this.chessboard.props.assetsCache?"":this.view.getSpriteUrl(),i=l.addElement(this.draggablePiece,"use",{href:"".concat(t,"#").concat(e)}),s=this.view.squareHeight/this.chessboard.props.style.pieces.tileSize,o=this.draggablePiece.createSVGTransform();o.setScale(s,s),i.transform.baseVal.appendItem(o)}moveDraggablePiece(e,t){this.draggablePiece.setAttribute("style","pointer-events: none; position: absolute; left: ".concat(e-this.view.squareHeight/2,"px; top: ").concat(t-this.view.squareHeight/2,"px"))}onPointerDown(e){if("mousedown"===e.type&&0===e.button||"touchstart"===e.type){let t=e.target.getAttribute("data-square");if(t){let i;let s=this.chessboard.getPiece(t);if(s&&("w"===(i=s?s.substring(0,1):void 0)&&this.chessboard.state.inputWhiteEnabled||"b"===i&&this.chessboard.state.inputBlackEnabled)&&e.preventDefault(),this.moveInputState!==f.waitForInputStart||this.chessboard.state.inputWhiteEnabled&&"w"===i||this.chessboard.state.inputBlackEnabled&&"b"===i){let o;if("mousedown"===e.type?o={x:e.clientX,y:e.clientY}:"touchstart"===e.type&&(o={x:e.touches[0].clientX,y:e.touches[0].clientY}),this.moveInputState===f.waitForInputStart&&s&&this.moveInputStartedCallback(t))this.setMoveInputState(f.pieceClickedThreshold,{square:t,piece:s,point:o,type:e.type});else if(this.moveInputState===f.clickTo){if(t===this.fromSquare)this.setMoveInputState(f.secondClickThreshold,{square:t,piece:s,point:o,type:e.type});else{let s=this.chessboard.getPiece(t),r=s?s.substring(0,1):void 0,n=this.chessboard.getPiece(this.fromSquare),a=n?n.substring(0,1):void 0;i&&a===r?(this.moveInputCanceledCallback(this.fromSquare,t,P.clickedAnotherPiece),this.moveInputStartedCallback(t)?this.setMoveInputState(f.pieceClickedThreshold,{square:t,piece:s,point:o,type:e.type}):this.setMoveInputState(f.reset)):this.setMoveInputState(f.moveDone,{square:t})}}}}}}onPointerMove(e){let t,i,s,o,r;if("mousemove"===e.type?(s=e.clientX,o=e.clientY,t=e.pageX,i=e.pageY,r=e.target):"touchmove"===e.type&&(s=e.touches[0].clientX,o=e.touches[0].clientY,t=e.touches[0].pageX,i=e.touches[0].pageY,r=document.elementFromPoint(s,o)),this.moveInputState===f.pieceClickedThreshold||this.moveInputState===f.secondClickThreshold)(Math.abs(this.startPoint.x-s)>4||Math.abs(this.startPoint.y-o)>4)&&(this.moveInputState===f.secondClickThreshold?this.setMoveInputState(f.clickDragTo,{square:this.fromSquare,piece:this.movedPiece}):this.setMoveInputState(f.dragTo,{square:this.fromSquare,piece:this.movedPiece}),this.view.chessboard.state.inputEnabled&&this.moveDraggablePiece(t,i));else if(this.moveInputState===f.dragTo||this.moveInputState===f.clickDragTo||this.moveInputState===f.clickTo){if(r&&r.getAttribute&&r.parentElement===this.view.boardGroup){let e=r.getAttribute("data-square");e!==this.fromSquare&&e!==this.toSquare?(this.toSquare=e,this.movingOverSquareCallback(this.fromSquare,this.toSquare)):e===this.fromSquare&&void 0!==this.toSquare&&(this.toSquare=void 0,this.movingOverSquareCallback(this.fromSquare,null))}else void 0!==this.toSquare&&(this.toSquare=void 0,this.movingOverSquareCallback(this.fromSquare,null));this.view.chessboard.state.inputEnabled&&(this.moveInputState===f.dragTo||this.moveInputState===f.clickDragTo)&&this.moveDraggablePiece(t,i)}}onPointerUp(e){let t;if("mouseup"===e.type?t=e.target:"touchend"===e.type&&(t=document.elementFromPoint(e.changedTouches[0].clientX,e.changedTouches[0].clientY)),t&&t.getAttribute){let e=t.getAttribute("data-square");if(e)this.moveInputState===f.dragTo||this.moveInputState===f.clickDragTo?this.fromSquare===e?this.moveInputState===f.clickDragTo?(this.chessboard.state.position.setPiece(this.fromSquare,this.movedPiece),this.view.setPieceVisibility(this.fromSquare),this.moveInputCanceledCallback(e,null,P.draggedBack),this.setMoveInputState(f.reset)):this.setMoveInputState(f.clickTo,{square:e}):this.setMoveInputState(f.moveDone,{square:e}):this.moveInputState===f.pieceClickedThreshold?this.setMoveInputState(f.clickTo,{square:e}):this.moveInputState===f.secondClickThreshold&&(this.setMoveInputState(f.reset),this.moveInputCanceledCallback(e,null,P.secondClick));else{this.view.redrawPieces();let e=this.fromSquare;this.setMoveInputState(f.reset),this.moveInputCanceledCallback(e,null,P.movedOutOfBoard)}}else this.view.redrawPieces(),this.setMoveInputState(f.reset)}onContextMenu(e){e.preventDefault(),this.view.redrawPieces(),this.setMoveInputState(f.reset),this.moveInputCanceledCallback(this.fromSquare,null,P.secondaryClick)}destroy(){this.setMoveInputState(f.reset)}constructor(e,t,i,s,o){this.view=e,this.chessboard=e.chessboard,this.moveInputStartedCallback=e=>{let i=t(e);return i&&(this.chessboard.state.moveInputProcess=m.createTask()),i},this.movingOverSquareCallback=(e,t)=>{i(e,t)},this.validateMoveInputCallback=(e,t)=>{let i=s(e,t);return this.chessboard.state.moveInputProcess.resolve(i),i},this.moveInputCanceledCallback=(e,t,i)=>{o(e,t,i),this.chessboard.state.moveInputProcess.resolve()},this.setMoveInputState(f.waitForInputStart)}}class w{pointerDownHandler(e){this.moveInput.onPointerDown(e)}destroy(){this.moveInput.destroy(),this.resizeObserver&&this.resizeObserver.unobserve(this.chessboard.context),this.resizeListener&&window.removeEventListener("resize",this.resizeListener),this.chessboard.context.removeEventListener("mousedown",this.pointerDownListener),this.chessboard.context.removeEventListener("touchstart",this.pointerDownListener),l.removeElement(this.svg)}cacheSpriteToDiv(e,t){if(!document.getElementById(e)){let i=document.createElement("div");i.style.display="none",i.id=e,document.body.appendChild(i);let s=new XMLHttpRequest;s.open("GET",t,!0),s.onload=function(){i.insertAdjacentHTML("afterbegin",s.response)},s.send()}}createSvgAndGroups(){this.svg=l.createSvg(this.context);let e=this.chessboard.props.style.cssClass?this.chessboard.props.style.cssClass:"default";this.svg.setAttribute("class","cm-chessboard border-type-"+this.chessboard.props.style.borderType+" "+e),this.svg.setAttribute("role","img"),this.updateMetrics(),this.boardGroup=l.addElement(this.svg,"g",{class:"board"}),this.coordinatesGroup=l.addElement(this.svg,"g",{class:"coordinates","aria-hidden":"true"}),this.markersLayer=l.addElement(this.svg,"g",{class:"markers-layer"}),this.piecesLayer=l.addElement(this.svg,"g",{class:"pieces-layer"}),this.piecesGroup=l.addElement(this.piecesLayer,"g",{class:"pieces"}),this.markersTopLayer=l.addElement(this.svg,"g",{class:"markers-top-layer"})}updateMetrics(){let e=this.chessboard.props.style.pieces.tileSize;this.width=this.context.clientWidth,this.height=this.context.clientWidth*(this.chessboard.props.style.aspectRatio||1),this.chessboard.props.style.borderType===S.frame?this.borderSize=this.width/25:this.chessboard.props.style.borderType===S.thin?this.borderSize=this.width/320:this.borderSize=0,this.innerWidth=this.width-2*this.borderSize,this.innerHeight=this.height-2*this.borderSize,this.squareWidth=this.innerWidth/8,this.squareHeight=this.innerHeight/8,this.scalingX=this.squareWidth/e,this.scalingY=this.squareHeight/e,this.pieceXTranslate=this.squareWidth/2-e*this.scalingY/2}handleResize(){this.context.style.width=this.chessboard.context.clientWidth+"px",this.context.style.height=this.chessboard.context.clientWidth*this.chessboard.props.style.aspectRatio+"px",(this.context.clientWidth!==this.width||this.context.clientHeight!==this.height)&&(this.updateMetrics(),this.redrawBoard(),this.redrawPieces()),this.svg.setAttribute("width","100%"),this.svg.setAttribute("height","100%")}redrawBoard(){this.redrawSquares(),this.drawCoordinates(),this.chessboard.state.invokeExtensionPoints(c.redrawBoard),this.visualizeInputState()}redrawSquares(){for(;this.boardGroup.firstChild;)this.boardGroup.removeChild(this.boardGroup.lastChild);if(l.addElement(this.boardGroup,"rect",{width:this.width,height:this.height}).setAttribute("class","border"),this.chessboard.props.style.borderType===S.frame){let e=this.borderSize;l.addElement(this.boardGroup,"rect",{x:e,y:e,width:this.width-2*e,height:this.height-2*e}).setAttribute("class","border-inner")}for(let e=0;e<64;e++){let t=this.chessboard.state.orientation===E.white?e:63-e,i=(9*t&8)==0?"black":"white",s="square ".concat(i),o=this.squareToPoint(n.indexToSquare(t)),r=l.addElement(this.boardGroup,"rect",{x:o.x,y:o.y,width:this.squareWidth,height:this.squareHeight});r.setAttribute("class",s),r.setAttribute("data-square",n.indexToSquare(t))}}drawCoordinates(){if(!this.chessboard.props.style.showCoordinates)return;for(;this.coordinatesGroup.firstChild;)this.coordinatesGroup.removeChild(this.coordinatesGroup.lastChild);let e=this.chessboard.props.style.borderType!==S.frame;for(let t=0;t<8;t++){let i=this.borderSize+(17+this.chessboard.props.style.pieces.tileSize*t)*this.scalingX,s=this.height-3.5*this.scalingY,o="coordinate file";e&&(i+=15.5*this.scalingX,o+=t%2?" white":" black");let r=l.addElement(this.coordinatesGroup,"text",{class:o,x:i,y:s,style:"font-size: ".concat(10*this.scalingY,"px")});this.chessboard.state.orientation===E.white?r.textContent=String.fromCharCode(97+t):r.textContent=String.fromCharCode(104-t)}for(let t=0;t<8;t++){let i=this.borderSize/3.7,s=this.borderSize+25*this.scalingY+t*this.squareHeight,o="coordinate rank";e&&(o+=t%2?" black":" white",this.chessboard.props.style.borderType===S.frame?(i+=10*this.scalingX,s-=15*this.scalingY):(i+=2*this.scalingX,s-=15*this.scalingY));let r=l.addElement(this.coordinatesGroup,"text",{class:o,x:i,y:s,style:"font-size: ".concat(10*this.scalingY,"px")});this.chessboard.state.orientation===E.white?r.textContent=""+(8-t):r.textContent=""+(1+t)}}redrawPieces(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.chessboard.state.position.squares,t=Array.from(this.piecesGroup.childNodes);for(let t=0;t<64;t++){let i=e[t];i&&this.drawPieceOnSquare(n.indexToSquare(t),i)}for(let e of t)this.piecesGroup.removeChild(e)}drawPiece(e,t,i){let s=l.addElement(e,"g",{});s.setAttribute("data-piece",t);let o=this.svg.createSVGTransform();o.setTranslate(i.x,i.y),s.transform.baseVal.appendItem(o);let r=this.chessboard.props.assetsCache?"":this.getSpriteUrl(),n=l.addElement(s,"use",{href:"".concat(r,"#").concat(t),class:"piece"}),a=this.svg.createSVGTransform();return a.setScale(this.scalingY,this.scalingY),n.transform.baseVal.appendItem(a),s}drawPieceOnSquare(e,t){let i=l.addElement(this.piecesGroup,"g",{});i.setAttribute("data-piece",t),i.setAttribute("data-square",e);let s=this.squareToPoint(e),o=this.svg.createSVGTransform();o.setTranslate(s.x,s.y),i.transform.baseVal.appendItem(o);let r=this.chessboard.props.assetsCache?"":this.getSpriteUrl(),n=l.addElement(i,"use",{href:"".concat(r,"#").concat(t),class:"piece"}),a=this.svg.createSVGTransform();a.setTranslate(this.pieceXTranslate,0),n.transform.baseVal.appendItem(a);let h=this.svg.createSVGTransform();return h.setScale(this.scalingY,this.scalingY),n.transform.baseVal.appendItem(h),i}setPieceVisibility(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],i=this.getPieceElement(e);i?t?i.setAttribute("visibility","visible"):i.setAttribute("visibility","hidden"):console.warn("no piece on",e)}getPieceElement(e){if(!e||e.length<2)return console.warn("invalid square",e),null;let t=this.piecesGroup.querySelector("g[data-square='".concat(e,"']"));return t||(console.warn("no piece on",e),null)}enableMoveInput(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;t===E.white?this.chessboard.state.inputWhiteEnabled=!0:(t===E.black||(this.chessboard.state.inputWhiteEnabled=!0),this.chessboard.state.inputBlackEnabled=!0),this.chessboard.state.inputEnabled=!0,this.moveInputCallback=e,this.chessboard.state.invokeExtensionPoints(c.moveInputToggled,{enabled:!0,color:t}),this.visualizeInputState()}disableMoveInput(){this.chessboard.state.inputWhiteEnabled=!1,this.chessboard.state.inputBlackEnabled=!1,this.chessboard.state.inputEnabled=!1,this.moveInputCallback=void 0,this.chessboard.state.invokeExtensionPoints(c.moveInputToggled,{enabled:!1}),this.visualizeInputState()}moveInputStartedCallback(e){let t={chessboard:this.chessboard,type:k.moveInputStarted,square:e,squareFrom:e,piece:this.chessboard.getPiece(e)};this.moveInputCallback&&(t.moveInputCallbackResult=this.moveInputCallback(t));let i=this.chessboard.state.invokeExtensionPoints(c.moveInput,t);return!(!1===i||!t.moveInputCallbackResult)}movingOverSquareCallback(e,t){let i={chessboard:this.chessboard,type:k.movingOverSquare,squareFrom:e,squareTo:t,piece:this.chessboard.getPiece(e)};this.chessboard.state.invokeExtensionPoints(c.moveInput,i)}validateMoveInputCallback(e,t){let i={chessboard:this.chessboard,type:k.validateMoveInput,squareFrom:e,squareTo:t,piece:this.chessboard.getPiece(e)};this.moveInputCallback&&(i.moveInputCallbackResult=this.moveInputCallback(i));let s=this.chessboard.state.invokeExtensionPoints(c.moveInput,i);return!(!1===s||!i.moveInputCallbackResult)}moveInputCanceledCallback(e,t,i){let s={chessboard:this.chessboard,type:k.moveInputCanceled,reason:i,squareFrom:e,squareTo:t};this.chessboard.state.invokeExtensionPoints(c.moveInput,s),this.moveInputCallback&&this.moveInputCallback(s)}visualizeInputState(){this.chessboard.state&&(this.chessboard.state.inputWhiteEnabled||this.chessboard.state.inputBlackEnabled||this.chessboard.state.squareSelectEnabled?this.boardGroup.setAttribute("class","board input-enabled"):this.boardGroup.setAttribute("class","board"))}indexToPoint(e){let t,i;return this.chessboard.state.orientation===E.white?(t=this.borderSize+e%8*this.squareWidth,i=this.borderSize+(7-Math.floor(e/8))*this.squareHeight):(t=this.borderSize+(7-e%8)*this.squareWidth,i=this.borderSize+Math.floor(e/8)*this.squareHeight),{x:t,y:i}}squareToPoint(e){let t=n.squareToIndex(e);return this.indexToPoint(t)}getSpriteUrl(){return this.chessboard.props.assetsUrl+"pieces/"+this.chessboard.props.style.pieces.file}constructor(e){this.chessboard=e,this.moveInput=new C(this,this.moveInputStartedCallback.bind(this),this.movingOverSquareCallback.bind(this),this.validateMoveInputCallback.bind(this),this.moveInputCanceledCallback.bind(this)),e.props.assetsCache&&this.cacheSpriteToDiv("cm-chessboard-sprite",this.getSpriteUrl()),this.context=document.createElement("div"),this.chessboard.context.appendChild(this.context),e.props.responsive&&("undefined"!=typeof ResizeObserver?(this.resizeObserver=new ResizeObserver(()=>{this.handleResize()}),this.resizeObserver.observe(this.chessboard.context)):(this.resizeListener=this.handleResize.bind(this),window.addEventListener("resize",this.resizeListener))),this.pointerDownListener=this.pointerDownHandler.bind(this),this.pointerDownListener=this.pointerDownHandler.bind(this),this.context.addEventListener("mousedown",this.pointerDownListener),this.context.addEventListener("touchstart",this.pointerDownListener),this.createSvgAndGroups(),this.updateMetrics(),this.handleResize(),this.redrawBoard()}}let E={white:"w",black:"b"},k={moveInputStarted:"moveInputStarted",movingOverSquare:"movingOverSquare",validateMoveInput:"validateMoveInput",moveInputCanceled:"moveInputCanceled"},y={primary:"primary",secondary:"secondary"},S={none:"none",thin:"thin",frame:"frame"},q={wp:"wp",wb:"wb",wn:"wn",wr:"wr",wq:"wq",wk:"wk",bp:"bp",bb:"bb",bn:"bn",br:"br",bq:"bq",bk:"bk"},x={svgSprite:"svgSprite"};class B{async setPiece(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=this.state.position.clone();return this.state.position.setPiece(e,t),this.state.invokeExtensionPoints(c.positionChanged),this.positionAnimationsQueue.enqueuePositionChange(s,this.state.position.clone(),i)}async movePiece(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=this.state.position.clone();return this.state.position.movePiece(e,t),this.state.invokeExtensionPoints(c.positionChanged),this.positionAnimationsQueue.enqueuePositionChange(s,this.state.position.clone(),i)}async setPosition(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.state.position.clone(),s=new n(e);return i.getFen()!==s.getFen()&&(this.state.position.setFen(e),this.state.invokeExtensionPoints(c.positionChanged)),this.positionAnimationsQueue.enqueuePositionChange(i,this.state.position.clone(),t)}async setOrientation(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.state.position.clone();if(this.boardTurning){console.log("setOrientation is only once in queue allowed");return}return this.boardTurning=!0,this.positionAnimationsQueue.enqueueTurnBoard(i,e,t).then(()=>{this.boardTurning=!1,this.state.invokeExtensionPoints(c.boardChanged)})}getPiece(e){return this.state.position.getPiece(e)}getPosition(){return this.state.position.getFen()}getOrientation(){return this.state.orientation}enableMoveInput(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;this.view.enableMoveInput(e,t)}disableMoveInput(){this.view.disableMoveInput()}enableSquareSelect(e){if(this.squareSelectListener){console.warn("squareSelectListener already existing");return}this.squareSelectListener=function(t){let i=t.target.getAttribute("data-square");if("contextmenu"===t.type){t.preventDefault();return}e({mouseEvent:t,chessboard:this,type:2===t.button?y.secondary:y.primary,square:i})},this.context.addEventListener("contextmenu",this.squareSelectListener),this.context.addEventListener("mousedown",this.squareSelectListener),this.context.addEventListener("mouseup",this.squareSelectListener),this.context.addEventListener("touchstart",this.squareSelectListener),this.context.addEventListener("touchend",this.squareSelectListener),this.state.squareSelectEnabled=!0,this.view.visualizeInputState()}disableSquareSelect(){this.context.removeEventListener("contextmenu",this.squareSelectListener),this.context.removeEventListener("mousedown",this.squareSelectListener),this.context.removeEventListener("mouseup",this.squareSelectListener),this.context.removeEventListener("touchstart",this.squareSelectListener),this.context.removeEventListener("touchend",this.squareSelectListener),this.squareSelectListener=void 0,this.state.squareSelectEnabled=!1,this.view.visualizeInputState()}destroy(){this.state.invokeExtensionPoints(c.destroy),this.state.squareSelectEnabled&&this.disableSquareSelect(),this.positionAnimationsQueue.destroy(),this.view.destroy(),this.view=void 0,this.state=void 0}constructor(e,t={}){if(!e)throw Error("container element is "+e);for(let i of(this.context=e,this.id=(Math.random()+1).toString(36).substring(2,8),this.extensions=[],this.props={position:r.empty,orientation:E.white,responsive:!0,language:navigator.language.substring(0,2).toLowerCase(),assetsUrl:"./assets/",assetsCache:!0,style:{cssClass:"default",showCoordinates:!0,borderType:S.none,aspectRatio:1,pieces:{type:x.svgSprite,file:"standard.svg",tileSize:40},animationDuration:300},extensions:[]},m.mergeObjects(this.props,t),"de"!==this.props.language&&"en"!==this.props.language&&(this.props.language="en"),this.state=new a,this.view=new w(this),this.positionAnimationsQueue=new b(this),this.state.orientation=this.props.orientation,this.props.extensions))this.extensions.push(new i.class(this,i.props));this.view.redrawBoard(),this.state.position=new n(this.props.position),this.view.redrawPieces(),this.state.invokeExtensionPoints(c.positionChanged)}}let D={frame:{class:"marker-frame",slice:"markerFrame"},framePrimary:{class:"marker-frame-primary",slice:"markerFrame"},frameDanger:{class:"marker-frame-danger",slice:"markerFrame"},circle:{class:"marker-circle",slice:"markerCircle"},circlePrimary:{class:"marker-circle-primary",slice:"markerCircle"},circleDanger:{class:"marker-circle-danger",slice:"markerCircle"},square:{class:"marker-square",slice:"markerSquare"},dot:{class:"marker-dot",slice:"markerDot",position:"above"},bevel:{class:"marker-bevel",slice:"markerBevel"}};class I extends u{drawAutoMarkers(e){this.removeMarkers(this.autoMarker),(e.type!==k.moveInputStarted||e.moveInputCallbackResult)&&(e.type===k.moveInputStarted||e.type===k.movingOverSquare)&&(e.squareFrom&&this.addMarker(this.autoMarker,e.squareFrom),e.squareTo&&this.addMarker(this.autoMarker,e.squareTo))}onRedrawBoard(){for(;this.markerGroupUp.firstChild;)this.markerGroupUp.removeChild(this.markerGroupUp.firstChild);for(;this.markerGroupDown.firstChild;)this.markerGroupDown.removeChild(this.markerGroupDown.firstChild);this.markers.forEach(e=>{this.drawMarker(e)})}drawMarker(e){let t;(t="above"===e.type.position?l.addElement(this.markerGroupUp,"g"):l.addElement(this.markerGroupDown,"g")).setAttribute("data-square",e.square);let i=this.chessboard.view.squareToPoint(e.square),s=this.chessboard.view.svg.createSVGTransform();s.setTranslate(i.x,i.y),t.transform.baseVal.appendItem(s);let o=this.chessboard.props.assetsCache?"":this.chessboard.props.assetsUrl+"extensions/markers/"+this.props.sprite,r=l.addElement(t,"use",{href:"".concat(o,"#").concat(e.type.slice),class:"marker "+e.type.class}),n=this.chessboard.view.svg.createSVGTransform();return n.setScale(this.chessboard.view.scalingX,this.chessboard.view.scalingY),r.transform.baseVal.appendItem(n),t}addMarker(e,t){if("string"==typeof e||"object"==typeof t){console.error("changed the signature of `addMarker` to `(type, square)` with v5.1.x");return}this.markers.push(new A(t,e)),this.onRedrawBoard()}getMarkers(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if("string"==typeof e||"object"==typeof t){console.error("changed the signature of `getMarkers` to `(type, square)` with v5.1.x");return}let i=[];return this.markers.forEach(s=>{s.matches(t,e)&&i.push(s)}),i}removeMarkers(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if("string"==typeof e||"object"==typeof t){console.error("changed the signature of `removeMarkers` to `(type, square)` with v5.1.x");return}this.markers=this.markers.filter(i=>!i.matches(t,e)),this.onRedrawBoard()}constructor(e,t={}){super(e,t),this.registerExtensionPoint(c.redrawBoard,()=>{this.onRedrawBoard()}),this.props={autoMarkers:D.frame,sprite:"markers.svg"},Object.assign(this.props,t),this.autoMarker={},e.props.assetsCache&&e.view.cacheSpriteToDiv("cm-chessboard-markers",this.chessboard.props.assetsUrl+"extensions/markers/"+this.props.sprite),this.registerMethod("addMarker",this.addMarker),this.registerMethod("getMarkers",this.getMarkers),this.registerMethod("removeMarkers",this.removeMarkers),this.markerGroupDown=l.addElement(e.view.markersLayer,"g",{class:"markers"}),this.markerGroupUp=l.addElement(e.view.markersTopLayer,"g",{class:"markers"}),this.markers=[],this.props.autoMarkers&&(Object.assign(this.autoMarker,this.props.autoMarkers),this.registerExtensionPoint(c.moveInput,e=>{this.drawAutoMarkers(e)}))}}class A{matches(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(!t&&!e)return!0;if(t){if(e){if(this.type===t&&e===this.square)return!0}else if(this.type===t)return!0}else if(e===this.square)return!0;return!1}constructor(e,t){this.square=e,this.type=t}}let T={hidden:"hidden",displayRequested:"displayRequested",shown:"shown"};class M extends u{showPromotionDialog(e,t,i){this.state.dialogParams.square=e,this.state.dialogParams.color=t,this.state.callback=i,this.setDisplayState(T.displayRequested)}extensionPointRedrawBoard(){this.redrawDialog()}extensionPointAnimation(e){e.type===d.end&&this.state.displayState===T.displayRequested&&this.setDisplayState(T.shown)}drawPieceButton(e,t){let i=this.chessboard.view.squareWidth,s=this.chessboard.view.squareHeight;l.addElement(this.promotionDialogGroup,"rect",{x:t.x,y:t.y,width:i,height:s,class:"promotion-dialog-button","data-piece":e}),this.chessboard.view.drawPiece(this.promotionDialogGroup,e,t)}redrawDialog(){for(;this.promotionDialogGroup.firstChild;)this.promotionDialogGroup.removeChild(this.promotionDialogGroup.firstChild);if(this.state.displayState===T.shown){let e=this.chessboard.view.squareWidth,t=this.chessboard.view.squareHeight,i=this.chessboard.view.squareToPoint(this.state.dialogParams.square);i.x=i.x+e/2,i.y=i.y+t/2;let s=!1,o=parseInt(this.state.dialogParams.square.charAt(1),10);(this.chessboard.getOrientation()===E.white&&o<5||this.chessboard.getOrientation()===E.black&&o>=5)&&(s=!0);let r=s?-4*t:0,n=i.x+e>this.chessboard.view.width?-e:0;l.addElement(this.promotionDialogGroup,"rect",{x:i.x+n,y:i.y+r,width:e,height:4*t,class:"promotion-dialog"});let a=this.state.dialogParams;s?(this.drawPieceButton(q[a.color+"q"],{x:i.x+n,y:i.y-t}),this.drawPieceButton(q[a.color+"r"],{x:i.x+n,y:i.y-2*t}),this.drawPieceButton(q[a.color+"b"],{x:i.x+n,y:i.y-3*t}),this.drawPieceButton(q[a.color+"n"],{x:i.x+n,y:i.y-4*t})):(this.drawPieceButton(q[a.color+"q"],{x:i.x+n,y:i.y}),this.drawPieceButton(q[a.color+"r"],{x:i.x+n,y:i.y+t}),this.drawPieceButton(q[a.color+"b"],{x:i.x+n,y:i.y+2*t}),this.drawPieceButton(q[a.color+"n"],{x:i.x+n,y:i.y+3*t}))}}promotionDialogOnClickPiece(e){2!==e.button&&(e.target.dataset.piece?(this.state.callback({square:this.state.dialogParams.square,piece:e.target.dataset.piece}),this.setDisplayState(T.hidden)):this.promotionDialogOnCancel(e))}promotionDialogOnCancel(e){this.state.displayState===T.shown&&(e.preventDefault(),this.setDisplayState(T.hidden),this.state.callback(null))}contextMenu(e){e.preventDefault(),this.setDisplayState(T.hidden),this.state.callback(null)}setDisplayState(e){this.state.displayState=e,e===T.shown?(this.clickDelegate=m.delegate(this.chessboard.view.svg,"mousedown","*",this.promotionDialogOnClickPiece.bind(this)),this.contextMenuListener=this.contextMenu.bind(this),this.chessboard.view.svg.addEventListener("contextmenu",this.contextMenuListener)):e===T.hidden&&(this.clickDelegate.remove(),this.chessboard.view.svg.removeEventListener("contextmenu",this.contextMenuListener)),this.redrawDialog()}constructor(e,t={}){super(e,t),this.registerExtensionPoint(c.redrawBoard,this.extensionPointRedrawBoard.bind(this)),this.registerExtensionPoint(c.animation,this.extensionPointAnimation.bind(this)),this.registerMethod("showPromotionDialog",this.showPromotionDialog),this.promotionDialogGroup=l.addElement(e.view.markersTopLayer,"g",{class:"promotion-dialog-group"}),this.state={displayState:T.hidden,callback:void 0,dialogParams:{square:void 0,color:void 0}}}}let L={en:{colors:{w:"w",b:"b"},colors_long:{w:"White",b:"Black"},pieces:{p:"p",n:"n",b:"b",r:"r",q:"q",k:"k"},pieces_long:{p:"Pawn",n:"Knight",b:"Bishop",r:"Rook",q:"Queen",k:"King"}},de:{colors:{w:"w",b:"s"},colors_long:{w:"Wei\xdf",b:"Schwarz"},pieces:{p:"b",n:"s",b:"l",r:"t",q:"d",k:"k"},pieces_long:{p:"Bauer",n:"Springer",b:"L\xe4ufer",r:"Turm",q:"Dame",k:"K\xf6nig"}}};function F(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,s=L[e].pieces_long[t];return i&&(s+=" "+L[e].colors_long[i]),s}let G={de:{chessboard:"Schachbrett",pieces_lists:"Figurenlisten",board_as_table:"Schachbrett als Tabelle",move_piece:"Figur bewegen",from:"Zug von",to:"Zug nach",move:"Zug ausf\xfchren",input_white_enabled:"Eingabe Wei\xdf aktiviert",input_black_enabled:"Eingabe Schwarz aktiviert",input_disabled:"Eingabe deaktiviert",pieces:"Figuren"},en:{chessboard:"Chessboard",pieces_lists:"Pieces lists",board_as_table:"Chessboard as table",move_piece:"Move piece",from:"Move from",to:"Move to",move:"Make move",input_white_enabled:"Input white enabled",input_black_enabled:"Input black enabled",input_disabled:"Input disabled",pieces:"Pieces"}};class H extends u{constructor(e,t){if(super(e,t),this.props={brailleNotationInAlt:!0,movePieceForm:!0,boardAsTable:!0,piecesAsList:!0,visuallyHidden:!0},Object.assign(this.props,t),this.lang=e.props.language,this.tPieces=L[this.lang],this.t=G[this.lang],this.components=[],this.props.movePieceForm||this.props.boardAsTable||this.props.piecesAsList){let e=document.createElement("div");e.classList.add("cm-chessboard-accessibility"),this.chessboard.context.appendChild(e),this.props.visuallyHidden&&e.classList.add("visually-hidden"),this.props.movePieceForm&&this.components.push(new _(e,this)),this.props.boardAsTable&&this.components.push(new W(e,this)),this.props.piecesAsList&&this.components.push(new N(e,this))}this.props.brailleNotationInAlt&&this.components.push(new O(this))}}class O{redraw(){let e=this.extension.chessboard.state.position.getPieces(),t=L[this.extension.lang].colors.w.toUpperCase()+":",i=L[this.extension.lang].colors.b.toUpperCase()+":";for(let s of e){let e="p"===s.name?"":L[this.extension.lang].pieces[s.name].toUpperCase();"w"===s.color?t+=" "+e+s.position:i+=" "+e+s.position}let s="".concat(t,"\n").concat(i);this.extension.chessboard.view.svg.setAttribute("alt",s)}constructor(e){this.extension=e,e.registerExtensionPoint(c.positionChanged,()=>{this.redraw()})}}class _{redraw(){this.inputFrom&&(this.chessboard.state.inputWhiteEnabled||this.chessboard.state.inputBlackEnabled?(this.inputFrom.disabled=!1,this.inputTo.disabled=!1,this.moveButton.disabled=!1):(this.inputFrom.disabled=!0,this.inputTo.disabled=!0,this.moveButton.disabled=!0))}constructor(e,t){this.chessboard=t.chessboard,this.movePieceFormContainer=m.createDomElement('\n<div>\n    <h3 id="hl_form_'.concat(this.chessboard.id,'">').concat(t.t.move_piece,'</h3>\n    <form aria-labelledby="hl_form_').concat(this.chessboard.id,'">\n        <label for="move_piece_input_from_').concat(this.chessboard.id,'">').concat(t.t.from,'</label>\n        <input class="input-from" type="text" size="2" id="move_piece_input_from_').concat(this.chessboard.id,'"/>\n        <label for="move_piece_input_to_').concat(this.chessboard.id,'">').concat(t.t.to,'</label>\n        <input class="input-to" type="text" size="2" id="move_piece_input_to_').concat(this.chessboard.id,'"/>\n        <button type="submit" class="button-move">').concat(t.t.move,"</button>\n    </form>\n</div>")),this.form=this.movePieceFormContainer.querySelector("form"),this.inputFrom=this.form.querySelector(".input-from"),this.inputTo=this.form.querySelector(".input-to"),this.moveButton=this.form.querySelector(".button-move"),this.form.addEventListener("submit",e=>{e.preventDefault(),this.chessboard.view.moveInputCallback({chessboard:this.chessboard,type:k.validateMoveInput,squareFrom:this.inputFrom.value,squareTo:this.inputTo.value})&&this.chessboard.movePiece(this.inputFrom.value,this.inputTo.value,!0).then(()=>{this.inputFrom.value="",this.inputTo.value=""})}),e.appendChild(this.movePieceFormContainer),t.registerExtensionPoint(c.moveInputToggled,()=>{this.redraw()})}}class W{redraw(){let e=this.chessboard.state.position.squares.slice(),t=["a","b","c","d","e","f","g","h"],i=["8","7","6","5","4","3","2","1"];this.chessboard.state.orientation===E.black&&(t.reverse(),i.reverse(),e.reverse());let s='<table aria-labelledby="hl_table_'.concat(this.chessboard.id,'"><tr><th></th>');for(let e of t)s+="<th scope='col'>".concat(e,"</th>");s+="</tr>";for(let t=7;t>=0;t--){s+='<tr><th scope="row">'.concat(i[7-t],"</th>");for(let i=0;i<8;i++){let o,r;let n=e[i%8+8*t];n?(o=n.charAt(0),r=n.charAt(1),s+="<td>".concat(F(this.extension.lang,r,o),"</td>")):s+="<td></td>"}s+="</tr>"}s+="</table>",this.boardAsTable.innerHTML=s}constructor(e,t){this.extension=t,this.chessboard=t.chessboard,this.boardAsTableContainer=m.createDomElement('<div><h3 id="hl_table_'.concat(this.chessboard.id,'">').concat(t.t.board_as_table,'</h3><div class="table"></div></div>')),this.boardAsTable=this.boardAsTableContainer.querySelector(".table"),e.appendChild(this.boardAsTableContainer),t.registerExtensionPoint(c.positionChanged,()=>{this.redraw()}),t.registerExtensionPoint(c.boardChanged,()=>{this.redraw()})}}class N{redraw(){let e=this.chessboard.state.position.getPieces(),t="",i="";for(let s of e)"w"===s.color?t+='<li class="list-inline-item">'.concat(F(this.extension.lang,s.name)," ").concat(s.position,"</li>"):i+='<li class="list-inline-item">'.concat(F(this.extension.lang,s.name)," ").concat(s.position,"</li>");this.piecesList.innerHTML='\n        <h4 id="white_'.concat(this.chessboard.id,'">').concat(this.extension.t.pieces," ").concat(this.extension.tPieces.colors_long.w,'</h4>\n        <ul aria-labelledby="white_').concat(this.chessboard.id,'" class="list-inline">').concat(t,'</ul>\n        <h4 id="black_').concat(this.chessboard.id,'">').concat(this.extension.t.pieces," ").concat(this.extension.tPieces.colors_long.b,'</h4>\n        <ul aria-labelledby="black_').concat(this.chessboard.id,'" class="list-inline">').concat(i,"</ul>")}constructor(e,t){this.extension=t,this.chessboard=t.chessboard,this.piecesListContainer=m.createDomElement('<div><h3 id="hl_lists_'.concat(this.chessboard.id,'">').concat(t.t.pieces_lists,'</h3><div class="list"></div></div>')),this.piecesList=this.piecesListContainer.querySelector(".list"),e.appendChild(this.piecesListContainer),t.registerExtensionPoint(c.positionChanged,()=>{this.redraw()})}}let U=["A","B","C","D","E","F","G","H"],K=["1","2","3","4","5","6","7","8"],R={KING_W:"K",QUEEN_W:"Q",ROOK_W:"R",BISHOP_W:"B",KNIGHT_W:"N",PAWN_W:"P",KING_B:"k",QUEEN_B:"q",ROOK_B:"r",BISHOP_B:"b",KNIGHT_B:"n",PAWN_B:"p"},j={BLACK:"black",WHITE:"white"},z=[0,1,2,3,4],V={BASE:{0:1,1:2,2:2,3:3,4:3,5:4},EXTENDED:{0:2,1:2,2:4,3:4,4:5,5:5}},Q={fullMove:1,halfMove:0,enPassant:null,isFinished:!1,checkMate:!1,check:!1,turn:j.WHITE},X=Object.assign({pieces:{E1:"K",D1:"Q",A1:"R",H1:"R",C1:"B",F1:"B",B1:"N",G1:"N",A2:"P",B2:"P",C2:"P",D2:"P",E2:"P",F2:"P",G2:"P",H2:"P",E8:"k",D8:"q",A8:"r",H8:"r",C8:"b",F8:"b",B8:"n",G8:"n",A7:"p",B7:"p",C7:"p",D7:"p",E7:"p",F7:"p",G7:"p",H7:"p"},castling:{whiteShort:!0,blackShort:!0,whiteLong:!0,blackLong:!0}},Q),Y={UP:{A1:"A2",A2:"A3",A3:"A4",A4:"A5",A5:"A6",A6:"A7",A7:"A8",A8:null,B1:"B2",B2:"B3",B3:"B4",B4:"B5",B5:"B6",B6:"B7",B7:"B8",B8:null,C1:"C2",C2:"C3",C3:"C4",C4:"C5",C5:"C6",C6:"C7",C7:"C8",C8:null,D1:"D2",D2:"D3",D3:"D4",D4:"D5",D5:"D6",D6:"D7",D7:"D8",D8:null,E1:"E2",E2:"E3",E3:"E4",E4:"E5",E5:"E6",E6:"E7",E7:"E8",E8:null,F1:"F2",F2:"F3",F3:"F4",F4:"F5",F5:"F6",F6:"F7",F7:"F8",F8:null,G1:"G2",G2:"G3",G3:"G4",G4:"G5",G5:"G6",G6:"G7",G7:"G8",G8:null,H1:"H2",H2:"H3",H3:"H4",H4:"H5",H5:"H6",H6:"H7",H7:"H8",H8:null},DOWN:{A1:null,A2:"A1",A3:"A2",A4:"A3",A5:"A4",A6:"A5",A7:"A6",A8:"A7",B1:null,B2:"B1",B3:"B2",B4:"B3",B5:"B4",B6:"B5",B7:"B6",B8:"B7",C1:null,C2:"C1",C3:"C2",C4:"C3",C5:"C4",C6:"C5",C7:"C6",C8:"C7",D1:null,D2:"D1",D3:"D2",D4:"D3",D5:"D4",D6:"D5",D7:"D6",D8:"D7",E1:null,E2:"E1",E3:"E2",E4:"E3",E5:"E4",E6:"E5",E7:"E6",E8:"E7",F1:null,F2:"F1",F3:"F2",F4:"F3",F5:"F4",F6:"F5",F7:"F6",F8:"F7",G1:null,G2:"G1",G3:"G2",G4:"G3",G5:"G4",G6:"G5",G7:"G6",G8:"G7",H1:null,H2:"H1",H3:"H2",H4:"H3",H5:"H4",H6:"H5",H7:"H6",H8:"H7"},LEFT:{A1:null,A2:null,A3:null,A4:null,A5:null,A6:null,A7:null,A8:null,B1:"A1",B2:"A2",B3:"A3",B4:"A4",B5:"A5",B6:"A6",B7:"A7",B8:"A8",C1:"B1",C2:"B2",C3:"B3",C4:"B4",C5:"B5",C6:"B6",C7:"B7",C8:"B8",D1:"C1",D2:"C2",D3:"C3",D4:"C4",D5:"C5",D6:"C6",D7:"C7",D8:"C8",E1:"D1",E2:"D2",E3:"D3",E4:"D4",E5:"D5",E6:"D6",E7:"D7",E8:"D8",F1:"E1",F2:"E2",F3:"E3",F4:"E4",F5:"E5",F6:"E6",F7:"E7",F8:"E8",G1:"F1",G2:"F2",G3:"F3",G4:"F4",G5:"F5",G6:"F6",G7:"F7",G8:"F8",H1:"G1",H2:"G2",H3:"G3",H4:"G4",H5:"G5",H6:"G6",H7:"G7",H8:"G8"},RIGHT:{A1:"B1",A2:"B2",A3:"B3",A4:"B4",A5:"B5",A6:"B6",A7:"B7",A8:"B8",B1:"C1",B2:"C2",B3:"C3",B4:"C4",B5:"C5",B6:"C6",B7:"C7",B8:"C8",C1:"D1",C2:"D2",C3:"D3",C4:"D4",C5:"D5",C6:"D6",C7:"D7",C8:"D8",D1:"E1",D2:"E2",D3:"E3",D4:"E4",D5:"E5",D6:"E6",D7:"E7",D8:"E8",E1:"F1",E2:"F2",E3:"F3",E4:"F4",E5:"F5",E6:"F6",E7:"F7",E8:"F8",F1:"G1",F2:"G2",F3:"G3",F4:"G4",F5:"G5",F6:"G6",F7:"G7",F8:"G8",G1:"H1",G2:"H2",G3:"H3",G4:"H4",G5:"H5",G6:"H6",G7:"H7",G8:"H8",H1:null,H2:null,H3:null,H4:null,H5:null,H6:null,H7:null,H8:null},UP_LEFT:{A1:null,A2:null,A3:null,A4:null,A5:null,A6:null,A7:null,A8:null,B1:"A2",B2:"A3",B3:"A4",B4:"A5",B5:"A6",B6:"A7",B7:"A8",B8:null,C1:"B2",C2:"B3",C3:"B4",C4:"B5",C5:"B6",C6:"B7",C7:"B8",C8:null,D1:"C2",D2:"C3",D3:"C4",D4:"C5",D5:"C6",D6:"C7",D7:"C8",D8:null,E1:"D2",E2:"D3",E3:"D4",E4:"D5",E5:"D6",E6:"D7",E7:"D8",E8:null,F1:"E2",F2:"E3",F3:"E4",F4:"E5",F5:"E6",F6:"E7",F7:"E8",F8:null,G1:"F2",G2:"F3",G3:"F4",G4:"F5",G5:"F6",G6:"F7",G7:"F8",G8:null,H1:"G2",H2:"G3",H3:"G4",H4:"G5",H5:"G6",H6:"G7",H7:"G8",H8:null},DOWN_RIGHT:{A1:null,A2:"B1",A3:"B2",A4:"B3",A5:"B4",A6:"B5",A7:"B6",A8:"B7",B1:null,B2:"C1",B3:"C2",B4:"C3",B5:"C4",B6:"C5",B7:"C6",B8:"C7",C1:null,C2:"D1",C3:"D2",C4:"D3",C5:"D4",C6:"D5",C7:"D6",C8:"D7",D1:null,D2:"E1",D3:"E2",D4:"E3",D5:"E4",D6:"E5",D7:"E6",D8:"E7",E1:null,E2:"F1",E3:"F2",E4:"F3",E5:"F4",E6:"F5",E7:"F6",E8:"F7",F1:null,F2:"G1",F3:"G2",F4:"G3",F5:"G4",F6:"G5",F7:"G6",F8:"G7",G1:null,G2:"H1",G3:"H2",G4:"H3",G5:"H4",G6:"H5",G7:"H6",G8:"H7",H1:null,H2:null,H3:null,H4:null,H5:null,H6:null,H7:null,H8:null},UP_RIGHT:{A1:"B2",A2:"B3",A3:"B4",A4:"B5",A5:"B6",A6:"B7",A7:"B8",A8:null,B1:"C2",B2:"C3",B3:"C4",B4:"C5",B5:"C6",B6:"C7",B7:"C8",B8:null,C1:"D2",C2:"D3",C3:"D4",C4:"D5",C5:"D6",C6:"D7",C7:"D8",C8:null,D1:"E2",D2:"E3",D3:"E4",D4:"E5",D5:"E6",D6:"E7",D7:"E8",D8:null,E1:"F2",E2:"F3",E3:"F4",E4:"F5",E5:"F6",E6:"F7",E7:"F8",E8:null,F1:"G2",F2:"G3",F3:"G4",F4:"G5",F5:"G6",F6:"G7",F7:"G8",F8:null,G1:"H2",G2:"H3",G3:"H4",G4:"H5",G5:"H6",G6:"H7",G7:"H8",G8:null,H1:null,H2:null,H3:null,H4:null,H5:null,H6:null,H7:null,H8:null},DOWN_LEFT:{A1:null,A2:null,A3:null,A4:null,A5:null,A6:null,A7:null,A8:null,B1:null,B2:"A1",B3:"A2",B4:"A3",B5:"A4",B6:"A5",B7:"A6",B8:"A7",C1:null,C2:"B1",C3:"B2",C4:"B3",C5:"B4",C6:"B5",C7:"B6",C8:"B7",D1:null,D2:"C1",D3:"C2",D4:"C3",D5:"C4",D6:"C5",D7:"C6",D8:"C7",E1:null,E2:"D1",E3:"D2",E4:"D3",E5:"D4",E6:"D5",E7:"D6",E8:"D7",F1:null,F2:"E1",F3:"E2",F4:"E3",F5:"E4",F6:"E5",F7:"E6",F8:"E7",G1:null,G2:"F1",G3:"F2",G4:"F3",G5:"F4",G6:"F5",G7:"F6",G8:"F7",H1:null,H2:"G1",H3:"G2",H4:"G3",H5:"G4",H6:"G5",H7:"G6",H8:"G7"}},J=[[0,0,0,0,0,0,0,0],[5,5,5,5,5,5,5,5],[1,1,2,3,3,2,1,1],[.5,.5,1,2.5,2.5,1,.5,.5],[0,0,0,2,2,0,0,0],[.5,0,1,0,0,1,0,.5],[.5,0,0,-2,-2,0,0,.5],[0,0,0,0,0,0,0,0]],Z=[[-4,-3,-2,-2,-2,-2,-3,-4],[-3,-2,0,0,0,0,-2,-3],[-2,0,1,1.5,1.5,1,0,-2],[-2,.5,1.5,2,2,1.5,.5,-2],[-2,0,1.5,2,2,1.5,0,-2],[-2,.5,1,1.5,1.5,1,.5,-2],[-3,-2,0,.5,.5,0,-2,-3],[-4,-3,-2,-2,-2,-2,-3,-4]],$=[[-2,-1,-1,-1,-1,-1,-1,-2],[-1,0,0,0,0,0,0,-1],[-1,0,.5,1,1,.5,0,-1],[-1,.5,.5,1,1,.5,.5,-1],[-1,0,1,1,1,1,0,-1],[-1,1,1,1,1,1,1,-1],[-1,.5,0,0,0,0,.5,-1],[-2,-1,-1,-1,-1,-1,-1,-2]],ee=[[0,0,0,0,0,0,0,0],[.5,1,1,1,1,1,1,.5],[-.5,0,0,0,0,0,0,-.5],[-.5,0,0,0,0,0,0,-.5],[-.5,0,0,0,0,0,0,-.5],[-.5,0,0,0,0,0,0,-.5],[-.5,0,0,0,0,0,0,-.5],[0,0,0,.5,.5,0,0,0]],et=[[-3,-4,-4,-5,-5,-4,-4,-3],[-3,-4,-4,-5,-5,-4,-4,-3],[-3,-4,-4,-5,-5,-4,-4,-3],[-3,-4,-4,-5,-5,-4,-4,-3],[-2,-3,-3,-4,-4,-3,-3,-2],[-1,-2,-2,-2,-2,-2,-2,-1],[2,2,0,0,0,0,2,2],[2,3,1,0,0,1,3,2]],ei=[[-2,-1,-1,-.5,-.5,-1,-1,-2],[-1,0,0,0,0,0,0,-1],[-1,0,.5,.5,.5,.5,0,-1],[-.5,0,.5,.5,.5,.5,0,-.5],[0,0,.5,.5,.5,.5,0,-.5],[-1,.5,.5,.5,.5,.5,0,-1],[-1,0,.5,0,0,0,0,-1],[-2,-1,-1,-.5,-.5,-1,-1,-2]],es={P:J.slice().reverse(),p:J,N:Z.slice().reverse(),n:Z,B:$.slice().reverse(),b:$,R:ee.slice().reverse(),r:ee,K:et.slice().reverse(),k:et,Q:ei.slice().reverse(),q:ei};function eo(e){return Y.UP[e]}function er(e){return Y.DOWN[e]}function en(e){return Y.LEFT[e]}function ea(e){return Y.RIGHT[e]}function eh(e){return Y.UP_LEFT[e]}function el(e){return Y.UP_RIGHT[e]}function ec(e){return Y.DOWN_LEFT[e]}function eu(e){return Y.DOWN_RIGHT[e]}function ed(e){let t=eh(e);return t?eo(t):null}function ep(e){let t=eh(e);return t?en(t):null}function eg(e){let t=el(e);return t?eo(t):null}function ev(e){let t=el(e);return t?ea(t):null}function eb(e){let t=ec(e);return t?er(t):null}function em(e){let t=ec(e);return t?en(t):null}function ef(e){let t=eu(e);return t?er(t):null}function eP(e){let t=eu(e);return t?ea(t):null}function eC(e,t){return t===j.WHITE?Y.UP[e]:Y.DOWN[e]}function ew(e,t){return t===j.WHITE?Y.UP_LEFT[e]:Y.DOWN_RIGHT[e]}function eE(e,t){return t===j.WHITE?Y.UP_RIGHT[e]:Y.DOWN_LEFT[e]}function ek(e,t){return t===j.WHITE?Y.DOWN_LEFT[e]:Y.UP_RIGHT[e]}function ey(e,t){return t===j.WHITE?Y.DOWN_RIGHT[e]:Y.UP_LEFT[e]}var eS=i(3454);function eq(e){return({k:10,q:9,r:5,b:3,n:3,p:1})[e.toLowerCase()]||0}function ex(e){return"string"==typeof e&&e.match("^[a-hA-H]{1}[1-8]{1}$")}let eB={MIN:-1e3,MAX:1e3},eD=(e,t,i)=>{e[t]?e[t].push(i):e[t]=[i]};class eI{getAttackingFields(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getPlayingColor(),t=[];for(let i in this.configuration.pieces){let s=this.getPiece(i);this.getPieceColor(s)===e&&(t=[...t,...this.getPieceMoves(s,i)])}return t}isAttackingKing(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getPlayingColor(),t=null;for(let i in this.configuration.pieces){let s=this.getPiece(i);if(this.isKing(s)&&this.getPieceColor(s)!==e){t=i;break}}return this.isPieceUnderAttack(t)}isPieceUnderAttack(e){let t=this.getPieceOnLocationColor(e),i=this.getEnemyColor(t),s=!1,o=e,r=0;for(;eo(o)&&!s;){o=eo(o),r++;let e=this.getPiece(o);if(e&&this.getPieceColor(e)===i&&(this.isRook(e)||this.isQueen(e)||this.isKing(e)&&1===r)&&(s=!0),e)break}for(o=e,r=0;er(o)&&!s;){o=er(o),r++;let e=this.getPiece(o);if(e&&this.getPieceColor(e)===i&&(this.isRook(e)||this.isQueen(e)||this.isKing(e)&&1===r)&&(s=!0),e)break}for(o=e,r=0;en(o)&&!s;){o=en(o),r++;let e=this.getPiece(o);if(e&&this.getPieceColor(e)===i&&(this.isRook(e)||this.isQueen(e)||this.isKing(e)&&1===r)&&(s=!0),e)break}for(o=e,r=0;ea(o)&&!s;){o=ea(o),r++;let e=this.getPiece(o);if(e&&this.getPieceColor(e)===i&&(this.isRook(e)||this.isQueen(e)||this.isKing(e)&&1===r)&&(s=!0),e)break}for(o=e,r=0;eE(o,t)&&!s;){o=eE(o,t),r++;let e=this.getPiece(o);if(e&&this.getPieceColor(e)===i&&(this.isBishop(e)||this.isQueen(e)||1===r&&(this.isKing(e)||this.isPawn(e)))&&(s=!0),e)break}for(o=e,r=0;ew(o,t)&&!s;){o=ew(o,t),r++;let e=this.getPiece(o);if(e&&this.getPieceColor(e)===i&&(this.isBishop(e)||this.isQueen(e)||1===r&&(this.isKing(e)||this.isPawn(e)))&&(s=!0),e)break}for(o=e,r=0;ey(o,t)&&!s;){o=ey(o,t),r++;let e=this.getPiece(o);if(e&&this.getPieceColor(e)===i&&(this.isBishop(e)||this.isQueen(e)||this.isKing(e)&&1===r)&&(s=!0),e)break}for(o=e,r=0;ek(o,t)&&!s;){o=ek(o,t),r++;let e=this.getPiece(o);if(e&&this.getPieceColor(e)===i&&(this.isBishop(e)||this.isQueen(e)||this.isKing(e)&&1===r)&&(s=!0),e)break}o=eg(e);let n=this.getPiece(o);return n&&this.getPieceColor(n)===i&&this.isKnight(n)&&(s=!0),o=ev(e),(n=this.getPiece(o))&&this.getPieceColor(n)===i&&this.isKnight(n)&&(s=!0),o=ep(e),(n=this.getPiece(o))&&this.getPieceColor(n)===i&&this.isKnight(n)&&(s=!0),o=ed(e),(n=this.getPiece(o))&&this.getPieceColor(n)===i&&this.isKnight(n)&&(s=!0),o=eb(e),(n=this.getPiece(o))&&this.getPieceColor(n)===i&&this.isKnight(n)&&(s=!0),o=em(e),(n=this.getPiece(o))&&this.getPieceColor(n)===i&&this.isKnight(n)&&(s=!0),o=ef(e),(n=this.getPiece(o))&&this.getPieceColor(n)===i&&this.isKnight(n)&&(s=!0),o=eP(e),(n=this.getPiece(o))&&this.getPieceColor(n)===i&&this.isKnight(n)&&(s=!0),s}hasPlayingPlayerCheck(){return this.isAttackingKing(this.getNonPlayingColor())}hasNonPlayingPlayerCheck(){return this.isAttackingKing(this.getPlayingColor())}getLowestValuePieceAttackingLocation(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getPlayingColor(),i=null;for(let s in this.configuration.pieces){let o=this.getPiece(s);this.getPieceColor(o)===t&&this.getPieceMoves(o,s).map(t=>{t===e&&(null===i||eq(o)<i)&&(i=eq(o))})}return i}getValidMoves(e){return this.getMoves(this.getPlayingColor(),5,e?e.toUpperCase():null)}getMoves(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getPlayingColor(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s={},o=0,r=i?{[i]:this.configuration.pieces[i]}:this.configuration.pieces;for(let t in r){let i=this.getPiece(t);if(this.getPieceColor(i)===e){let e=this.getPieceMoves(i,t);e.length&&o++,Object.assign(s,{[t]:e})}}let n=this.getAttackingFields(this.getNonPlayingColor());if(this.isLeftCastlingPossible(n)&&(this.isPlayingWhite()&&eD(s,"E1","C1"),this.isPlayingBlack()&&eD(s,"E8","C1")),this.isRightCastlingPossible(n)&&(this.isPlayingWhite()&&eD(s,"E1","G1"),this.isPlayingBlack()&&eD(s,"E8","G8")),t&&o>t)return s;let a={};for(let e in s)s[e].map(t=>{let i={pieces:Object.assign({},this.configuration.pieces),castling:Object.assign({},this.configuration.castling)},s=new eI(i);s.move(e,t),(this.isPlayingWhite()&&!s.isAttackingKing(j.BLACK)||this.isPlayingBlack()&&!s.isAttackingKing(j.WHITE))&&(a[e]||(a[e]=[]),a[e].push(t))});return!Object.keys(a).length&&(this.configuration.isFinished=!0,this.hasPlayingPlayerCheck()&&(this.configuration.checkMate=!0)),a}isLeftCastlingPossible(e){if(this.isPlayingWhite()&&!this.configuration.castling.whiteLong||this.isPlayingBlack()&&!this.configuration.castling.blackLong)return!1;let t=null;if(this.isPlayingWhite()&&"K"===this.getPiece("E1")&&"R"===this.getPiece("A1")&&!e.includes("E1")?t="E1":this.isPlayingBlack()&&"k"===this.getPiece("E8")&&"r"===this.getPiece("A8")&&!e.includes("E8")&&(t="E8"),!t)return!1;let i=en(t);return!(this.getPiece(i)||e.includes(i))&&(i=en(i),!(this.getPiece(i)||e.includes(i))&&(i=en(i),!this.getPiece(i)))}isRightCastlingPossible(e){if(this.isPlayingWhite()&&!this.configuration.castling.whiteShort||this.isPlayingBlack()&&!this.configuration.castling.blackShort)return!1;let t=null;if(this.isPlayingWhite()&&"K"===this.getPiece("E1")&&"R"===this.getPiece("H1")&&!e.includes("E1")?t="E1":this.isPlayingBlack()&&"k"===this.getPiece("E8")&&"r"===this.getPiece("H8")&&!e.includes("E8")&&(t="E8"),!t)return!1;let i=ea(t);return!(this.getPiece(i)||e.includes(i))&&(i=ea(i),!(this.getPiece(i)||e.includes(i)))}getPieceMoves(e,t){return this.isPawn(e)?this.getPawnMoves(e,t):this.isKnight(e)?this.getKnightMoves(e,t):this.isRook(e)?this.getRookMoves(e,t):this.isBishop(e)?this.getBishopMoves(e,t):this.isQueen(e)?this.getQueenMoves(e,t):this.isKing(e)?this.getKingMoves(e,t):[]}isPawn(e){return"P"===e.toUpperCase()}isKnight(e){return"N"===e.toUpperCase()}isRook(e){return"R"===e.toUpperCase()}isBishop(e){return"B"===e.toUpperCase()}isQueen(e){return"Q"===e.toUpperCase()}isKing(e){return"K"===e.toUpperCase()}getPawnMoves(e,t){let i=[],s=this.getPieceColor(e),o=eC(t,s);return o&&!this.getPiece(o)&&(i.push(o),o=eC(o,s),(s===j.WHITE&&"2"===t[1]||s===j.BLACK&&"7"===t[1])&&o&&!this.getPiece(o)&&i.push(o)),(o=ew(t,s))&&(this.getPiece(o)&&this.getPieceOnLocationColor(o)!==s||o===this.configuration.enPassant)&&i.push(o),(o=eE(t,s))&&(this.getPiece(o)&&this.getPieceOnLocationColor(o)!==s||o===this.configuration.enPassant)&&i.push(o),i}getKnightMoves(e,t){let i=[],s=this.getPieceColor(e),o=eg(t);return o&&this.getPieceOnLocationColor(o)!==s&&i.push(o),(o=ev(t))&&this.getPieceOnLocationColor(o)!==s&&i.push(o),(o=ed(t))&&this.getPieceOnLocationColor(o)!==s&&i.push(o),(o=ep(t))&&this.getPieceOnLocationColor(o)!==s&&i.push(o),(o=em(t))&&this.getPieceOnLocationColor(o)!==s&&i.push(o),(o=eb(t))&&this.getPieceOnLocationColor(o)!==s&&i.push(o),(o=eP(t))&&this.getPieceOnLocationColor(o)!==s&&i.push(o),(o=ef(t))&&this.getPieceOnLocationColor(o)!==s&&i.push(o),i}getRookMoves(e,t){let i=[],s=this.getPieceColor(e),o=t;for(;eo(o);){o=eo(o);let e=this.getPieceOnLocationColor(o);if(this.getPieceOnLocationColor(o)!==s&&i.push(o),e)break}for(o=t;er(o);){o=er(o);let e=this.getPieceOnLocationColor(o);if(this.getPieceOnLocationColor(o)!==s&&i.push(o),e)break}for(o=t;ea(o);){o=ea(o);let e=this.getPieceOnLocationColor(o);if(this.getPieceOnLocationColor(o)!==s&&i.push(o),e)break}for(o=t;en(o);){o=en(o);let e=this.getPieceOnLocationColor(o);if(this.getPieceOnLocationColor(o)!==s&&i.push(o),e)break}return i}getBishopMoves(e,t){let i=[],s=this.getPieceColor(e),o=t;for(;eh(o);){o=eh(o);let e=this.getPieceOnLocationColor(o);if(this.getPieceOnLocationColor(o)!==s&&i.push(o),e)break}for(o=t;el(o);){o=el(o);let e=this.getPieceOnLocationColor(o);if(this.getPieceOnLocationColor(o)!==s&&i.push(o),e)break}for(o=t;ec(o);){o=ec(o);let e=this.getPieceOnLocationColor(o);if(this.getPieceOnLocationColor(o)!==s&&i.push(o),e)break}for(o=t;eu(o);){o=eu(o);let e=this.getPieceOnLocationColor(o);if(this.getPieceOnLocationColor(o)!==s&&i.push(o),e)break}return i}getQueenMoves(e,t){let i=[...this.getRookMoves(e,t),...this.getBishopMoves(e,t)];return i}getKingMoves(e,t){let i=[],s=this.getPieceColor(e),o=t;return(o=eo(o))&&this.getPieceOnLocationColor(o)!==s&&i.push(o),(o=ea(o=t))&&this.getPieceOnLocationColor(o)!==s&&i.push(o),(o=er(o=t))&&this.getPieceOnLocationColor(o)!==s&&i.push(o),(o=en(o=t))&&this.getPieceOnLocationColor(o)!==s&&i.push(o),(o=eh(o=t))&&this.getPieceOnLocationColor(o)!==s&&i.push(o),(o=el(o=t))&&this.getPieceOnLocationColor(o)!==s&&i.push(o),(o=ec(o=t))&&this.getPieceOnLocationColor(o)!==s&&i.push(o),(o=eu(o=t))&&this.getPieceOnLocationColor(o)!==s&&i.push(o),i}getPieceColor(e){return e.toUpperCase()===e?j.WHITE:j.BLACK}getPieceOnLocationColor(e){let t=this.getPiece(e);return t?t.toUpperCase()===t?j.WHITE:j.BLACK:null}getPiece(e){return this.configuration.pieces[e]}setPiece(e,t){if(!Object.values(R).includes(t))throw Error("Invalid piece ".concat(t));if(!ex(e))throw Error("Invalid location ".concat(e));this.configuration.pieces[e.toUpperCase()]=t}removePiece(e){if(!ex(e))throw Error("Invalid location ".concat(e));delete this.configuration.pieces[e.toUpperCase()]}isEmpty(e){if(!ex(e))throw Error("Invalid location ".concat(e));return!this.configuration.pieces[e.toUpperCase()]}getEnemyColor(e){return e===j.WHITE?j.BLACK:j.WHITE}getPlayingColor(){return this.configuration.turn}getNonPlayingColor(){return this.isPlayingWhite()?j.BLACK:j.WHITE}isPlayingWhite(){return this.configuration.turn===j.WHITE}isPlayingBlack(){return this.configuration.turn===j.BLACK}addMoveToHistory(e,t){this.history.push({from:e,to:t,configuration:JSON.parse(JSON.stringify(this.configuration))})}move(e,t){let i=this.getPiece(e),s=this.getPiece(t);if(!i)throw Error("There is no piece at ".concat(e));if(Object.assign(this.configuration.pieces,{[t]:i}),delete this.configuration.pieces[e],this.isPlayingWhite()&&this.isPawn(i)&&"8"===t[1]&&Object.assign(this.configuration.pieces,{[t]:"Q"}),this.isPlayingBlack()&&this.isPawn(i)&&"1"===t[1]&&Object.assign(this.configuration.pieces,{[t]:"q"}),this.isPawn(i)&&t===this.configuration.enPassant&&delete this.configuration.pieces[this.getPlayingColor()===j.WHITE?Y.DOWN[t]:Y.UP[t]],this.isPawn(i)&&this.isPlayingWhite()&&"2"===e[1]&&"4"===t[1]?this.configuration.enPassant="".concat(e[0],"3"):this.isPawn(i)&&this.isPlayingBlack()&&"7"===e[1]&&"5"===t[1]?this.configuration.enPassant="".concat(e[0],"6"):this.configuration.enPassant=null,"E1"===e&&Object.assign(this.configuration.castling,{whiteLong:!1,whiteShort:!1}),"E8"===e&&Object.assign(this.configuration.castling,{blackLong:!1,blackShort:!1}),"A1"===e&&Object.assign(this.configuration.castling,{whiteLong:!1}),"H1"===e&&Object.assign(this.configuration.castling,{whiteShort:!1}),"A8"===e&&Object.assign(this.configuration.castling,{blackLong:!1}),"H8"===e&&Object.assign(this.configuration.castling,{blackShort:!1}),this.isKing(i)){if("E1"===e&&"C1"===t)return this.move("A1","D1");if("E8"===e&&"C8"===t)return this.move("A8","D8");if("E1"===e&&"G1"===t)return this.move("H1","F1");if("E8"===e&&"G8"===t)return this.move("H8","F8")}this.configuration.turn=this.isPlayingWhite()?j.BLACK:j.WHITE,this.isPlayingWhite()&&this.configuration.fullMove++,this.configuration.halfMove++,(s||this.isPawn(i))&&(this.configuration.halfMove=0)}exportJson(){return{moves:this.getMoves(),pieces:this.configuration.pieces,turn:this.configuration.turn,isFinished:this.configuration.isFinished,check:this.hasPlayingPlayerCheck(),checkMate:this.configuration.checkMate,castling:this.configuration.castling,enPassant:this.configuration.enPassant,halfMove:this.configuration.halfMove,fullMove:this.configuration.fullMove}}calculateAiMove(e){let t=this.calculateAiMoves(e);return t[0]}calculateAiMoves(e){if(e=parseInt(e),!z.includes(e))throw Error("Invalid level ".concat(e,". You can choose ").concat(z.join(",")));this.shouldIncreaseLevel()&&e++;let t=[],i=this.calculateScore(this.getPlayingColor()),s=this.getMoves();for(let o in s)s[o].map(s=>{let r=this.getTestBoard(),n=!!r.getPiece(s);r.move(o,s),t.push({from:o,to:s,score:r.testMoveScores(this.getPlayingColor(),e,n,n?r.calculateScore(this.getPlayingColor()):i,s).score+r.calculateScoreByPiecesLocation(this.getPlayingColor())+Math.floor(Math.random()*(this.configuration.halfMove>10?this.configuration.halfMove-10:1)*10)/10})});return t.sort((e,t)=>e.score<t.score?1:e.score>t.score?-1:0),t}shouldIncreaseLevel(){return 50>this.getIngamePiecesValue()}getIngamePiecesValue(){let e=0;for(let t in this.configuration.pieces){let i=this.getPiece(t);e+=eq(i)}return e}getTestBoard(){let e={pieces:Object.assign({},this.configuration.pieces),castling:Object.assign({},this.configuration.castling),turn:this.configuration.turn,enPassant:this.configuration.enPassant};return new eI(e)}testMoveScores(e,t,i,s,o){let r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,n=null;if(r<V.EXTENDED[t]&&this.hasPlayingPlayerCheck()?n=this.getMoves(this.getPlayingColor()):(r<V.BASE[t]||i&&r<V.EXTENDED[t])&&(n=this.getMoves(this.getPlayingColor(),5)),this.configuration.isFinished)return{score:this.calculateScore(e)+(this.getPlayingColor()===e?r:-r),max:!0};if(!n){if(null!==s)return{score:s,max:!1};let t=this.calculateScore(e);return{score:t,max:!1}}let a=this.getPlayingColor()===e?eB.MIN:eB.MAX,h=!1;for(let i in n)h||n[i].map(o=>{if(h)return;let n=this.getTestBoard(),l=!!n.getPiece(o);if(n.move(i,o),n.hasNonPlayingPlayerCheck())return;let c=n.testMoveScores(e,t,l,l?n.calculateScore(e):s,o,r+1);c.max&&(h=!0),a=this.getPlayingColor()===e?Math.max(a,c.score):Math.min(a,c.score)});return{score:a,max:!1}}calculateScoreByPiecesLocation(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getPlayingColor(),t={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7},i=0;for(let s in this.configuration.pieces){let o=this.getPiece(s);if(es[o]){let r=es[o][s[1]-1][t[s[0]]];i+=(this.getPieceColor(o)===e?r:-r)*.5}}return i}calculateScore(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getPlayingColor(),t=0;if(this.configuration.checkMate)return this.getPlayingColor()===e?eB.MIN:eB.MAX;if(this.configuration.isFinished)return this.getPlayingColor()===e?eB.MAX:eB.MIN;for(let i in this.configuration.pieces){let s=this.getPiece(i);this.getPieceColor(s)===e?t+=10*eq(s):t-=10*eq(s)}return t}constructor(e=JSON.parse(JSON.stringify(X))){if("object"==typeof e)this.configuration=Object.assign({},Q,e);else if("string"==typeof e)this.configuration=Object.assign({},Q,function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",[t,i,s,o,r,n]=e.split(" "),a={pieces:Object.fromEntries(t.split("/").flatMap((e,t)=>{let i=0;return e.split("").reduce((e,s)=>{let o=s.match(/k|b|q|n|p|r/i);o&&(e.push(["".concat(U[i]).concat(K[7-t]),o[0]]),i+=1);let r=s.match(/[1-8]/);return r&&(i+=Number(r)),e},[])}))};return"b"===i?a.turn=j.BLACK:a.turn=j.WHITE,a.castling={whiteLong:!1,whiteShort:!1,blackLong:!1,blackShort:!1},s.includes("K")&&(a.castling.whiteShort=!0),s.includes("k")&&(a.castling.blackShort=!0),s.includes("Q")&&(a.castling.whiteLong=!0),s.includes("q")&&(a.castling.blackLong=!0),ex(o)&&(a.enPassant=o.toUpperCase()),a.halfMove=parseInt(r),a.fullMove=parseInt(n),a}(e));else throw Error("Unknown configuration type ".concat(typeof config,"."));this.configuration.castling||(this.configuration.castling={whiteShort:!0,blackShort:!0,whiteLong:!0,blackLong:!0}),this.history=[]}}class eA{move(e,t){e=e.toUpperCase(),t=t.toUpperCase();let i=this.board.getValidMoves(e);if(!i[e]||!i[e].includes(t))throw Error("Invalid move from ".concat(e," to ").concat(t," for ").concat(this.board.getPlayingColor()));return this.board.addMoveToHistory(e,t),this.board.move(e,t),{[e]:t}}moves(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return(e?this.board.getValidMoves(e)[e.toUpperCase()]:this.board.getMoves())||[]}setPiece(e,t){this.board.setPiece(e,t)}removePiece(e){this.board.removePiece(e)}aiMove(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2,t=this.board.calculateAiMove(e);return this.move(t.from,t.to)}getHistory(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e?this.board.history.reverse():this.board.history}printToConsole(){var e;let t;e=this.board.configuration,eS.stdout.write("\n"),t=j.WHITE,Object.assign([],K).reverse().map(i=>{eS.stdout.write("".concat(i)),U.map(s=>{switch(e.pieces["".concat(s).concat(i)]){case"K":eS.stdout.write("");break;case"Q":eS.stdout.write("");break;case"R":eS.stdout.write("");break;case"B":eS.stdout.write("");break;case"N":eS.stdout.write("");break;case"P":eS.stdout.write("");break;case"k":eS.stdout.write("");break;case"q":eS.stdout.write("");break;case"r":eS.stdout.write("");break;case"b":eS.stdout.write("");break;case"n":eS.stdout.write("");break;case"p":eS.stdout.write("");break;default:eS.stdout.write(t===j.WHITE?"":"")}t=t===j.WHITE?j.BLACK:j.WHITE}),t=t===j.WHITE?j.BLACK:j.WHITE,eS.stdout.write("\n")}),eS.stdout.write(" "),U.map(e=>{eS.stdout.write("".concat(e))}),eS.stdout.write("\n")}exportJson(){return this.board.exportJson()}exportFEN(){return function(e){let t="";Object.assign([],K).reverse().map(i=>{let s=0;i<8&&(t+="/"),U.map(o=>{let r=e.pieces["".concat(o).concat(i)];r?(s&&(t+=s.toString(),s=0),t+=r):s++}),t+="".concat(s||"")}),t+=e.turn===j.WHITE?" w ":" b ";let{whiteShort:i,whiteLong:s,blackLong:o,blackShort:r}=e.castling;return s||i||o||r?(i&&(t+="K"),s&&(t+="Q"),r&&(t+="k"),o&&(t+="q")):t+="-",t+=" ".concat(e.enPassant?e.enPassant.toLowerCase():"-")+" ".concat(e.halfMove)+" ".concat(e.fullMove)}(this.board.configuration)}constructor(e){this.board=new eI(e)}}let eT=(e,t)=>({color:void 0,flags:"n",from:e.toLowerCase(),piece:void 0,san:void 0,to:t.toLowerCase()}),eM=new class extends eA{fen(){return super.exportFEN()}aiMove(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2,t=this.board.calculateAiMove(e);return t?eT(t.from,t.to):null}moves(){let{square:e,verbose:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=super.moves(e),s=[];return Array.isArray(i)?i.forEach(t=>s.push(eT(e,t))):Object.entries(i).forEach(e=>{let[t,i]=e;("string"==typeof i?[i]:i).forEach(e=>{s.push(eT(t,e))})}),s}movePiece(e){let{from:t,to:i}=e;try{let e=super.move(t,i),[s,o]=Object.entries(e)[0];return{color:void 0,flags:"n",from:t.toLowerCase(),piece:void 0,san:void 0,to:i.toLowerCase()}}catch(e){if(this.observer)this.observer.onMoveError(e);else throw e}}setObserver(e){this.observer=e}constructor(e){super(e)}};function eL(e){let{observer:t}=e,i=eM.aiMove(4);i?setTimeout(()=>{eM.movePiece({from:i.from,to:i.to}),e.setPosition(eM.fen(),!0),e.enableMoveInput(eF,E.white),t.onEngineMoveEnd()},500):t.onEngineMoveEnd()}function eF(e){if(e.chessboard.removeMarkers(D.dot),e.chessboard.removeMarkers(D.bevel),e.type===k.moveInputStarted){let t=eM.moves({square:e.square,verbose:!0});for(let i of t)i.promotion&&"q"!==i.promotion||(e.chessboard.getPiece(i.to)?e.chessboard.addMarker(D.bevel,i.to):e.chessboard.addMarker(D.dot,i.to));return t.length>0}if(e.type===k.validateMoveInput){let t={from:e.squareFrom,to:e.squareTo,promotion:e.promotion},i=eM.movePiece(t);if(i)e.chessboard.disableMoveInput(),this.chessboard.state.moveInputProcess.then(()=>{this.chessboard.setPosition(eM.fen(),!0).then(()=>{this.chessboard.observer.onEngineMoveStart(),setTimeout(()=>{eL(e.chessboard)},500)})});else for(let t of eM.moves({square:e.squareFrom,verbose:!0}))if(t.promotion&&t.to===e.squareTo)return e.chessboard.showPromotionDialog(e.squareTo,E.white,t=>{t?(eM.movePiece({from:e.squareFrom,to:e.squareTo,promotion:t.piece.charAt(1)}),e.chessboard.setPosition(eM.fen(),!0),setTimeout(()=>{eL(e.chessboard)},500)):(e.chessboard.setPosition(eM.fen(),!0),e.chessboard.enableMoveInput(eF,E.white))}),!0;return i}}function eG(){let e={onEngineMoveStart:()=>{document.getElementsByClassName("chess-game")[0].classList.add("thinking")},onEngineMoveEnd:()=>{document.getElementsByClassName("chess-game")[0].classList.remove("thinking")},onMoveError:e=>{console.error("Invalid move",e)}};return(0,o.useEffect)(()=>{!function(e,t){let i=new B(document.getElementById(e),{position:eM.fen(),assetsUrl:"/assets/chess/",style:{borderType:S.thin,pieces:{file:"staunty.svg"}},orientation:E.white,extensions:[{class:I,props:{autoMarkers:D.square}},{class:M},{class:H,props:{visuallyHidden:!0}}]});i.enableMoveInput(eF,E.white),i.observer=t,eM.setObserver(t)}("board",e)},[]),(0,s.jsx)("section",{className:"chess-game",children:(0,s.jsxs)("div",{className:"chess-container",children:[(0,s.jsx)("div",{className:"board",id:"board"}),(0,s.jsx)("div",{id:"output",children:(0,s.jsxs)("div",{className:"indicator",children:[(0,s.jsx)("span",{className:"circle"}),(0,s.jsx)("span",{children:"Thinking.."})]})})]})})}},7663:function(e){!function(){var t={229:function(e){var t,i,s,o=e.exports={};function r(){throw Error("setTimeout has not been defined")}function n(){throw Error("clearTimeout has not been defined")}function a(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(i){try{return t.call(null,e,0)}catch(i){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:r}catch(e){t=r}try{i="function"==typeof clearTimeout?clearTimeout:n}catch(e){i=n}}();var h=[],l=!1,c=-1;function u(){l&&s&&(l=!1,s.length?h=s.concat(h):c=-1,h.length&&d())}function d(){if(!l){var e=a(u);l=!0;for(var t=h.length;t;){for(s=h,h=[];++c<t;)s&&s[c].run();c=-1,t=h.length}s=null,l=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===n||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function g(){}o.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];h.push(new p(e,t)),1!==h.length||l||a(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=g,o.addListener=g,o.once=g,o.off=g,o.removeListener=g,o.removeAllListeners=g,o.emit=g,o.prependListener=g,o.prependOnceListener=g,o.listeners=function(e){return[]},o.binding=function(e){throw Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw Error("process.chdir is not supported")},o.umask=function(){return 0}}},i={};function s(e){var o=i[e];if(void 0!==o)return o.exports;var r=i[e]={exports:{}},n=!0;try{t[e](r,r.exports,s),n=!1}finally{n&&delete i[e]}return r.exports}s.ab="//";var o=s(229);e.exports=o}()}},function(e){e.O(0,[774,888,179],function(){return e(e.s=1560)}),_N_E=e.O()}]);