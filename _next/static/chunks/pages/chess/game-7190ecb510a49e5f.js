(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[257],{1560:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chess/game",function(){return s(8362)}])},8362:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return eh}});var i=s(5893),r=s(7294);let o={start:"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",empty:"8/8/8/8/8/8/8/8"};class n{setFen(){let e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:o.empty;"start"===t?(console.warn("setting the position with the strings 'start' or 'empty' is deprecated, use FEN.start or FEN.empty","used:",t),e=o.start):"empty"===t||void 0===t?(console.warn("setting the position with the strings 'start' or 'empty' is deprecated, use FEN.start or FEN.empty","used:",t),e=o.empty):e=t;let s=e.replace(/^\s*/,"").replace(/\s*$/,"").split(/\/|\s/);for(let e=0;e<8;e++){let t=s[7-e].replace(/\d/g,e=>{let t=parseInt(e),s="";for(let e=0;e<t;e++)s+="-";return s});for(let s=0;s<8;s++){let i=t.substring(s,s+1),r=null;"-"!==i&&(r=i.toUpperCase()===i?"w".concat(i.toLowerCase()):"b".concat(i)),this.squares[8*e+s]=r}}}getFen(){let e=Array(8).fill("");for(let t=0;t<8;t++){let s=0;for(let i=0;i<8;i++){let r=this.squares[8*t+i];if(r){s>0&&(e[7-t]+=s,s=0);let i=r.substring(0,1),o=r.substring(1,2);"w"===i?e[7-t]+=o.toUpperCase():e[7-t]+=o}else s++}s>0&&(e[7-t]+=s,s=0)}return e.join("/")}getPieces(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["k","q","r","b","n","p"],t=[],s=(t,s)=>e.indexOf(t.name)-e.indexOf(s.name);for(let e=0;e<64;e++){let s=this.squares[e];s&&t.push({name:s.charAt(1),color:s.charAt(0),position:n.indexToSquare(e)})}return e&&t.sort(s),t}movePiece(e,t){if(!this.squares[n.squareToIndex(e)]){console.warn("no piece on",e);return}this.squares[n.squareToIndex(t)]=this.squares[n.squareToIndex(e)],this.squares[n.squareToIndex(e)]=void 0}setPiece(e,t){this.squares[n.squareToIndex(e)]=t}getPiece(e){return this.squares[n.squareToIndex(e)]}static squareToIndex(e){let t=e.substring(0,1).charCodeAt(0)-97,s=e.substring(1,2)-1;return 8*s+t}static indexToSquare(e){let t=String.fromCharCode(e%8+97);return t+(Math.floor(e/8)+1)}clone(){let e=new n;return e.squares=this.squares.slice(0),e}constructor(e){this.squares=Array(64).fill(null),this.setFen(e)}}class a{invokeExtensionPoints(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=this.extensionPoints[e],i=Object.assign({},t);i.extensionPoint=e;let r=!0;if(s)for(let e of s)!1===e(i)&&(r=!1);return r}constructor(){this.position=new n,this.orientation=void 0,this.markers=[],this.inputWhiteEnabled=!1,this.inputBlackEnabled=!1,this.inputEnabled=!1,this.squareSelectEnabled=!1,this.extensionPoints={},this.moveInputProcess=Promise.resolve()}}let h="http://www.w3.org/2000/svg";class c{static createSvg(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=document.createElementNS(h,"svg");return e&&(t.setAttribute("width","100%"),t.setAttribute("height","100%"),e.appendChild(t)),t}static addElement(e,t,s){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:void 0,r=document.createElementNS(h,t);for(let e in"use"===t&&(s["xlink:href"]=s.href),s)if(s.hasOwnProperty(e)){if(-1!==e.indexOf(":")){let t=e.split(":");r.setAttributeNS("http://www.w3.org/1999/"+t[0],t[1],s[e])}else r.setAttribute(e,s[e])}return void 0!==i?e.appendChild(r):e.insertBefore(r,i),r}static removeElement(e){e.parentNode?e.parentNode.removeChild(e):console.warn(e,"without parentNode")}}let l={positionChanged:"positionChanged",boardChanged:"boardChanged",moveInputToggled:"moveInputToggled",moveInput:"moveInput",redrawBoard:"redrawBoard",animation:"animation",destroy:"destroy"};class u{registerExtensionPoint(e,t){this.chessboard.state.extensionPoints[e]||(this.chessboard.state.extensionPoints[e]=[]),this.chessboard.state.extensionPoints[e].push(t)}registerMethod(e,t){if(this.chessboard[e])log.error("method",e,"already exists");else{var s=this;this.chessboard[e]=function(){for(var e=arguments.length,i=Array(e),r=0;r<e;r++)i[r]=arguments[r];return t.apply(s,i)}}}constructor(e,t){this.chessboard=e,this.props=t}}let d={start:"start",frame:"frame",end:"end"};class p{async enqueue(e){return new Promise((t,s)=>{this.queue.push({promise:e,resolve:t,reject:s}),this.dequeue()})}dequeue(){if(this.workingOnPromise)return;if(this.stop){this.queue=[],this.stop=!1;return}let e=this.queue.shift();if(e){try{this.workingOnPromise=!0,e.promise().then(t=>{this.workingOnPromise=!1,e.resolve(t),this.dequeue()}).catch(t=>{this.workingOnPromise=!1,e.reject(t),this.dequeue()})}catch(t){this.workingOnPromise=!1,e.reject(t),this.dequeue()}return!0}}destroy(){this.stop=!0}constructor(){this.queue=[],this.workingOnPromise=!1,this.stop=!1}}let v={move:0,appear:1,disappear:2};class m{static seekChanges(e,t){let s=[],i=[],r=[];for(let r=0;r<64;r++){let o=e[r],n=t[r];n!==o&&(n&&s.push({piece:n,index:r}),o&&i.push({piece:o,index:r}))}return s.forEach(e=>{let t,s=8;i.forEach(i=>{if(e.piece===i.piece){let r=m.squareDistance(e.index,i.index);r<s&&(t=i,s=r)}}),t?(i.splice(i.indexOf(t),1),r.push({type:v.move,piece:e.piece,atIndex:t.index,toIndex:e.index})):r.push({type:v.appear,piece:e.piece,atIndex:e.index})}),i.forEach(e=>{r.push({type:v.disappear,piece:e.piece,atIndex:e.index})}),r}createAnimation(e,t){let s=m.seekChanges(e,t),i=[];return s.forEach(e=>{let t={type:e.type};switch(e.type){case v.move:t.element=this.view.getPieceElement(n.indexToSquare(e.atIndex)),t.element.parentNode.appendChild(t.element),t.atPoint=this.view.indexToPoint(e.atIndex),t.toPoint=this.view.indexToPoint(e.toIndex);break;case v.appear:t.element=this.view.drawPieceOnSquare(n.indexToSquare(e.atIndex),e.piece),t.element.style.opacity=0;break;case v.disappear:t.element=this.view.getPieceElement(n.indexToSquare(e.atIndex))}i.push(t)}),i}animationStep(e){if(!this.view||!this.view.chessboard.state)return;this.startTime||(this.startTime=e,this.view.chessboard.state.invokeExtensionPoints(l.animation,{type:d.start}));let t=e-this.startTime;if(t<=this.duration)this.frameHandle=requestAnimationFrame(this.animationStep.bind(this));else{cancelAnimationFrame(this.frameHandle),this.animatedElements.forEach(e=>{e.type===v.disappear&&c.removeElement(e.element)}),this.view.chessboard.state.invokeExtensionPoints(l.animation,{type:d.end}),this.callback();return}let s=Math.min(1,t/this.duration),i=s<.5?2*s*s:-1+(4-2*s)*s;(isNaN(i)||i>.99)&&(i=1),this.animatedElements.forEach(e=>{if(e.element)switch(e.type){case v.move:e.element.transform.baseVal.removeItem(0);let t=this.view.svg.createSVGTransform();t.setTranslate(e.atPoint.x+(e.toPoint.x-e.atPoint.x)*i,e.atPoint.y+(e.toPoint.y-e.atPoint.y)*i),e.element.transform.baseVal.appendItem(t);break;case v.appear:e.element.style.opacity=Math.round(100*i)/100;break;case v.disappear:e.element.style.opacity=Math.round((1-i)*100)/100}else console.warn("animatedItem has no element",e)}),this.view.chessboard.state.invokeExtensionPoints(l.animation,{type:d.frame,progress:i})}static squareDistance(e,t){return Math.max(Math.abs(Math.floor(t/8)-Math.floor(e/8)),Math.abs(t%8-e%8))}constructor(e,t,s,i,r){this.view=e,t&&s?(this.animatedElements=this.createAnimation(t.squares,s.squares),this.duration=i,this.callback=r,this.frameHandle=requestAnimationFrame(this.animationStep.bind(this))):console.error("fromPosition",t,"toPosition",s)}}class b extends p{async enqueuePositionChange(e,t,s){return e.getFen()===t.getFen()?Promise.resolve():super.enqueue(()=>new Promise(i=>{let r=s?this.chessboard.props.style.animationDuration:0;this.queue.length>0&&(r/=1+Math.pow(this.queue.length/5,2)),new m(this.chessboard.view,e,t,s?r:0,()=>{this.chessboard.view&&this.chessboard.view.redrawPieces(t.squares),i()})}))}async enqueueTurnBoard(e,t,s){return super.enqueue(()=>new Promise(i=>{let r=new n(o.empty),a=s?this.chessboard.props.style.animationDuration:0;this.queue.length>0&&(a/=1+Math.pow(this.queue.length/5,2)),new m(this.chessboard.view,e,r,s?a:0,()=>{this.chessboard.state.orientation=t,this.chessboard.view.redrawBoard(),this.chessboard.view.redrawPieces(r.squares),new m(this.chessboard.view,r,e,s?a:0,()=>{this.chessboard.view.redrawPieces(e.squares),i()})})}))}constructor(e){super(),this.chessboard=e}}class f{static delegate(e,t,s,i){let r=function(e){let t=e.target;for(;t&&t!==this;)t.matches(s)&&i.call(t,e),t=t.parentNode};return e.addEventListener(t,r),{remove:function(){e.removeEventListener(t,r)}}}static mergeObjects(e,t){if(!(e&&"object"==typeof e)||!(t&&"object"==typeof t))return t;for(let s of Object.keys(t))t[s]instanceof Object&&Object.assign(t[s],f.mergeObjects(e[s],t[s]));return Object.assign(e||{},t),e}static createDomElement(e){let t=document.createElement("template");return t.innerHTML=e.trim(),t.content.firstChild}static createTask(){let e,t;let s=new Promise(function(s,i){e=s,t=i});return s.resolve=e,s.reject=t,s}}let g={waitForInputStart:0,pieceClickedThreshold:1,clickTo:2,secondClickThreshold:3,dragTo:4,clickDragTo:5,moveDone:6,reset:7},w={secondClick:"secondClick",secondaryClick:"secondaryClick",movedOutOfBoard:"movedOutOfBoard",draggedBack:"draggedBack",clickedAnotherPiece:"clickedAnotherPiece"};class y{setMoveInputState(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,s=this.moveInputState;switch(this.moveInputState=e,e){case g.waitForInputStart:break;case g.pieceClickedThreshold:if(g.waitForInputStart!==s&&g.clickTo!==s)throw Error("moveInputState");if(this.pointerMoveListener&&(removeEventListener(this.pointerMoveListener.type,this.pointerMoveListener),this.pointerMoveListener=void 0),this.pointerUpListener&&(removeEventListener(this.pointerUpListener.type,this.pointerUpListener),this.pointerUpListener=void 0),this.fromSquare=t.square,this.toSquare=void 0,this.movedPiece=t.piece,this.startPoint=t.point,this.pointerMoveListener||this.pointerUpListener)throw Error("94ad0c");if("mousedown"===t.type)this.pointerMoveListener=this.onPointerMove.bind(this),this.pointerMoveListener.type="mousemove",addEventListener("mousemove",this.pointerMoveListener),this.pointerUpListener=this.onPointerUp.bind(this),this.pointerUpListener.type="mouseup",addEventListener("mouseup",this.pointerUpListener);else if("touchstart"===t.type)this.pointerMoveListener=this.onPointerMove.bind(this),this.pointerMoveListener.type="touchmove",addEventListener("touchmove",this.pointerMoveListener),this.pointerUpListener=this.onPointerUp.bind(this),this.pointerUpListener.type="touchend",addEventListener("touchend",this.pointerUpListener);else throw Error("4b74af");this.contextMenuListener||(this.contextMenuListener=this.onContextMenu.bind(this),this.chessboard.view.svg.addEventListener("contextmenu",this.contextMenuListener));break;case g.clickTo:this.draggablePiece&&(c.removeElement(this.draggablePiece),this.draggablePiece=void 0),s===g.dragTo&&this.view.setPieceVisibility(t.square,!0);break;case g.secondClickThreshold:if(g.clickTo!==s)throw Error("moveInputState");this.startPoint=t.point;break;case g.dragTo:if(g.pieceClickedThreshold!==s)throw Error("moveInputState");this.view.chessboard.state.inputEnabled&&(this.view.setPieceVisibility(t.square,!1),this.createDraggablePiece(t.piece));break;case g.clickDragTo:if(g.secondClickThreshold!==s)throw Error("moveInputState");this.view.chessboard.state.inputEnabled&&(this.view.setPieceVisibility(t.square,!1),this.createDraggablePiece(t.piece));break;case g.moveDone:if(-1===[g.dragTo,g.clickTo,g.clickDragTo].indexOf(s))throw Error("moveInputState");this.toSquare=t.square,this.toSquare&&this.validateMoveInputCallback(this.fromSquare,this.toSquare)?s===g.clickTo?this.chessboard.movePiece(this.fromSquare,this.toSquare,!0).then(()=>{this.setMoveInputState(g.reset)}):this.chessboard.movePiece(this.fromSquare,this.toSquare,!1).then(()=>{this.view.setPieceVisibility(this.toSquare,!0),this.setMoveInputState(g.reset)}):(this.view.setPieceVisibility(this.fromSquare,!0),this.setMoveInputState(g.reset));break;case g.reset:this.fromSquare&&!this.toSquare&&this.movedPiece&&this.chessboard.state.position.setPiece(this.fromSquare,this.movedPiece),this.fromSquare=void 0,this.toSquare=void 0,this.movedPiece=void 0,this.draggablePiece&&(c.removeElement(this.draggablePiece),this.draggablePiece=void 0),this.pointerMoveListener&&(removeEventListener(this.pointerMoveListener.type,this.pointerMoveListener),this.pointerMoveListener=void 0),this.pointerUpListener&&(removeEventListener(this.pointerUpListener.type,this.pointerUpListener),this.pointerUpListener=void 0),this.contextMenuListener&&(removeEventListener("contextmenu",this.contextMenuListener),this.contextMenuListener=void 0),this.setMoveInputState(g.waitForInputStart);break;default:throw Error("260b09: moveInputState ".concat(e))}}createDraggablePiece(e){if(this.draggablePiece)throw Error("59c195");this.draggablePiece=c.createSvg(document.body),this.draggablePiece.classList.add("cm-chessboard-draggable-piece"),this.draggablePiece.setAttribute("width",this.view.squareWidth),this.draggablePiece.setAttribute("height",this.view.squareHeight),this.draggablePiece.setAttribute("style","pointer-events: none"),this.draggablePiece.name=e;let t=this.chessboard.props.assetsCache?"":this.view.getSpriteUrl(),s=c.addElement(this.draggablePiece,"use",{href:"".concat(t,"#").concat(e)}),i=this.view.squareHeight/this.chessboard.props.style.pieces.tileSize,r=this.draggablePiece.createSVGTransform();r.setScale(i,i),s.transform.baseVal.appendItem(r)}moveDraggablePiece(e,t){this.draggablePiece.setAttribute("style","pointer-events: none; position: absolute; left: ".concat(e-this.view.squareHeight/2,"px; top: ").concat(t-this.view.squareHeight/2,"px"))}onPointerDown(e){if("mousedown"===e.type&&0===e.button||"touchstart"===e.type){let t=e.target.getAttribute("data-square");if(t){let s;let i=this.chessboard.getPiece(t);if(i&&("w"===(s=i?i.substring(0,1):void 0)&&this.chessboard.state.inputWhiteEnabled||"b"===s&&this.chessboard.state.inputBlackEnabled)&&e.preventDefault(),this.moveInputState!==g.waitForInputStart||this.chessboard.state.inputWhiteEnabled&&"w"===s||this.chessboard.state.inputBlackEnabled&&"b"===s){let r;if("mousedown"===e.type?r={x:e.clientX,y:e.clientY}:"touchstart"===e.type&&(r={x:e.touches[0].clientX,y:e.touches[0].clientY}),this.moveInputState===g.waitForInputStart&&i&&this.moveInputStartedCallback(t))this.setMoveInputState(g.pieceClickedThreshold,{square:t,piece:i,point:r,type:e.type});else if(this.moveInputState===g.clickTo){if(t===this.fromSquare)this.setMoveInputState(g.secondClickThreshold,{square:t,piece:i,point:r,type:e.type});else{let i=this.chessboard.getPiece(t),o=i?i.substring(0,1):void 0,n=this.chessboard.getPiece(this.fromSquare),a=n?n.substring(0,1):void 0;s&&a===o?(this.moveInputCanceledCallback(this.fromSquare,t,w.clickedAnotherPiece),this.moveInputStartedCallback(t)?this.setMoveInputState(g.pieceClickedThreshold,{square:t,piece:i,point:r,type:e.type}):this.setMoveInputState(g.reset)):this.setMoveInputState(g.moveDone,{square:t})}}}}}}onPointerMove(e){let t,s,i,r,o;if("mousemove"===e.type?(i=e.clientX,r=e.clientY,t=e.pageX,s=e.pageY,o=e.target):"touchmove"===e.type&&(i=e.touches[0].clientX,r=e.touches[0].clientY,t=e.touches[0].pageX,s=e.touches[0].pageY,o=document.elementFromPoint(i,r)),this.moveInputState===g.pieceClickedThreshold||this.moveInputState===g.secondClickThreshold)(Math.abs(this.startPoint.x-i)>4||Math.abs(this.startPoint.y-r)>4)&&(this.moveInputState===g.secondClickThreshold?this.setMoveInputState(g.clickDragTo,{square:this.fromSquare,piece:this.movedPiece}):this.setMoveInputState(g.dragTo,{square:this.fromSquare,piece:this.movedPiece}),this.view.chessboard.state.inputEnabled&&this.moveDraggablePiece(t,s));else if(this.moveInputState===g.dragTo||this.moveInputState===g.clickDragTo||this.moveInputState===g.clickTo){if(o&&o.getAttribute&&o.parentElement===this.view.boardGroup){let e=o.getAttribute("data-square");e!==this.fromSquare&&e!==this.toSquare?(this.toSquare=e,this.movingOverSquareCallback(this.fromSquare,this.toSquare)):e===this.fromSquare&&void 0!==this.toSquare&&(this.toSquare=void 0,this.movingOverSquareCallback(this.fromSquare,null))}else void 0!==this.toSquare&&(this.toSquare=void 0,this.movingOverSquareCallback(this.fromSquare,null));this.view.chessboard.state.inputEnabled&&(this.moveInputState===g.dragTo||this.moveInputState===g.clickDragTo)&&this.moveDraggablePiece(t,s)}}onPointerUp(e){let t;if("mouseup"===e.type?t=e.target:"touchend"===e.type&&(t=document.elementFromPoint(e.changedTouches[0].clientX,e.changedTouches[0].clientY)),t&&t.getAttribute){let e=t.getAttribute("data-square");if(e)this.moveInputState===g.dragTo||this.moveInputState===g.clickDragTo?this.fromSquare===e?this.moveInputState===g.clickDragTo?(this.chessboard.state.position.setPiece(this.fromSquare,this.movedPiece),this.view.setPieceVisibility(this.fromSquare),this.moveInputCanceledCallback(e,null,w.draggedBack),this.setMoveInputState(g.reset)):this.setMoveInputState(g.clickTo,{square:e}):this.setMoveInputState(g.moveDone,{square:e}):this.moveInputState===g.pieceClickedThreshold?this.setMoveInputState(g.clickTo,{square:e}):this.moveInputState===g.secondClickThreshold&&(this.setMoveInputState(g.reset),this.moveInputCanceledCallback(e,null,w.secondClick));else{this.view.redrawPieces();let e=this.fromSquare;this.setMoveInputState(g.reset),this.moveInputCanceledCallback(e,null,w.movedOutOfBoard)}}else this.view.redrawPieces(),this.setMoveInputState(g.reset)}onContextMenu(e){e.preventDefault(),this.view.redrawPieces(),this.setMoveInputState(g.reset),this.moveInputCanceledCallback(this.fromSquare,null,w.secondaryClick)}destroy(){this.setMoveInputState(g.reset)}constructor(e,t,s,i,r){this.view=e,this.chessboard=e.chessboard,this.moveInputStartedCallback=e=>{let s=t(e);return s&&(this.chessboard.state.moveInputProcess=f.createTask()),s},this.movingOverSquareCallback=(e,t)=>{s(e,t)},this.validateMoveInputCallback=(e,t)=>{let s=i(e,t);return this.chessboard.state.moveInputProcess.resolve(s),s},this.moveInputCanceledCallback=(e,t,s)=>{r(e,t,s),this.chessboard.state.moveInputProcess.resolve()},this.setMoveInputState(g.waitForInputStart)}}class k{pointerDownHandler(e){this.moveInput.onPointerDown(e)}destroy(){this.moveInput.destroy(),this.resizeObserver&&this.resizeObserver.unobserve(this.chessboard.context),this.resizeListener&&window.removeEventListener("resize",this.resizeListener),this.chessboard.context.removeEventListener("mousedown",this.pointerDownListener),this.chessboard.context.removeEventListener("touchstart",this.pointerDownListener),c.removeElement(this.svg)}cacheSpriteToDiv(e,t){if(!document.getElementById(e)){let s=document.createElement("div");s.style.display="none",s.id=e,document.body.appendChild(s);let i=new XMLHttpRequest;i.open("GET",t,!0),i.onload=function(){s.insertAdjacentHTML("afterbegin",i.response)},i.send()}}createSvgAndGroups(){this.svg=c.createSvg(this.context);let e=this.chessboard.props.style.cssClass?this.chessboard.props.style.cssClass:"default";this.svg.setAttribute("class","cm-chessboard border-type-"+this.chessboard.props.style.borderType+" "+e),this.svg.setAttribute("role","img"),this.updateMetrics(),this.boardGroup=c.addElement(this.svg,"g",{class:"board"}),this.coordinatesGroup=c.addElement(this.svg,"g",{class:"coordinates","aria-hidden":"true"}),this.markersLayer=c.addElement(this.svg,"g",{class:"markers-layer"}),this.piecesLayer=c.addElement(this.svg,"g",{class:"pieces-layer"}),this.piecesGroup=c.addElement(this.piecesLayer,"g",{class:"pieces"}),this.markersTopLayer=c.addElement(this.svg,"g",{class:"markers-top-layer"})}updateMetrics(){let e=this.chessboard.props.style.pieces.tileSize;this.width=this.context.clientWidth,this.height=this.context.clientWidth*(this.chessboard.props.style.aspectRatio||1),this.chessboard.props.style.borderType===E.frame?this.borderSize=this.width/25:this.chessboard.props.style.borderType===E.thin?this.borderSize=this.width/320:this.borderSize=0,this.innerWidth=this.width-2*this.borderSize,this.innerHeight=this.height-2*this.borderSize,this.squareWidth=this.innerWidth/8,this.squareHeight=this.innerHeight/8,this.scalingX=this.squareWidth/e,this.scalingY=this.squareHeight/e,this.pieceXTranslate=this.squareWidth/2-e*this.scalingY/2}handleResize(){this.context.style.width=this.chessboard.context.clientWidth+"px",this.context.style.height=this.chessboard.context.clientWidth*this.chessboard.props.style.aspectRatio+"px",(this.context.clientWidth!==this.width||this.context.clientHeight!==this.height)&&(this.updateMetrics(),this.redrawBoard(),this.redrawPieces()),this.svg.setAttribute("width","100%"),this.svg.setAttribute("height","100%")}redrawBoard(){this.redrawSquares(),this.drawCoordinates(),this.chessboard.state.invokeExtensionPoints(l.redrawBoard),this.visualizeInputState()}redrawSquares(){for(;this.boardGroup.firstChild;)this.boardGroup.removeChild(this.boardGroup.lastChild);if(c.addElement(this.boardGroup,"rect",{width:this.width,height:this.height}).setAttribute("class","border"),this.chessboard.props.style.borderType===E.frame){let e=this.borderSize;c.addElement(this.boardGroup,"rect",{x:e,y:e,width:this.width-2*e,height:this.height-2*e}).setAttribute("class","border-inner")}for(let e=0;e<64;e++){let t=this.chessboard.state.orientation===S.white?e:63-e,s=(9*t&8)==0?"black":"white",i="square ".concat(s),r=this.squareToPoint(n.indexToSquare(t)),o=c.addElement(this.boardGroup,"rect",{x:r.x,y:r.y,width:this.squareWidth,height:this.squareHeight});o.setAttribute("class",i),o.setAttribute("data-square",n.indexToSquare(t))}}drawCoordinates(){if(!this.chessboard.props.style.showCoordinates)return;for(;this.coordinatesGroup.firstChild;)this.coordinatesGroup.removeChild(this.coordinatesGroup.lastChild);let e=this.chessboard.props.style.borderType!==E.frame;for(let t=0;t<8;t++){let s=this.borderSize+(17+this.chessboard.props.style.pieces.tileSize*t)*this.scalingX,i=this.height-3.5*this.scalingY,r="coordinate file";e&&(s+=15.5*this.scalingX,r+=t%2?" white":" black");let o=c.addElement(this.coordinatesGroup,"text",{class:r,x:s,y:i,style:"font-size: ".concat(10*this.scalingY,"px")});this.chessboard.state.orientation===S.white?o.textContent=String.fromCharCode(97+t):o.textContent=String.fromCharCode(104-t)}for(let t=0;t<8;t++){let s=this.borderSize/3.7,i=this.borderSize+25*this.scalingY+t*this.squareHeight,r="coordinate rank";e&&(r+=t%2?" black":" white",this.chessboard.props.style.borderType===E.frame?(s+=10*this.scalingX,i-=15*this.scalingY):(s+=2*this.scalingX,i-=15*this.scalingY));let o=c.addElement(this.coordinatesGroup,"text",{class:r,x:s,y:i,style:"font-size: ".concat(10*this.scalingY,"px")});this.chessboard.state.orientation===S.white?o.textContent=""+(8-t):o.textContent=""+(1+t)}}redrawPieces(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.chessboard.state.position.squares,t=Array.from(this.piecesGroup.childNodes);for(let t=0;t<64;t++){let s=e[t];s&&this.drawPieceOnSquare(n.indexToSquare(t),s)}for(let e of t)this.piecesGroup.removeChild(e)}drawPiece(e,t,s){let i=c.addElement(e,"g",{});i.setAttribute("data-piece",t);let r=this.svg.createSVGTransform();r.setTranslate(s.x,s.y),i.transform.baseVal.appendItem(r);let o=this.chessboard.props.assetsCache?"":this.getSpriteUrl(),n=c.addElement(i,"use",{href:"".concat(o,"#").concat(t),class:"piece"}),a=this.svg.createSVGTransform();return a.setScale(this.scalingY,this.scalingY),n.transform.baseVal.appendItem(a),i}drawPieceOnSquare(e,t){let s=c.addElement(this.piecesGroup,"g",{});s.setAttribute("data-piece",t),s.setAttribute("data-square",e);let i=this.squareToPoint(e),r=this.svg.createSVGTransform();r.setTranslate(i.x,i.y),s.transform.baseVal.appendItem(r);let o=this.chessboard.props.assetsCache?"":this.getSpriteUrl(),n=c.addElement(s,"use",{href:"".concat(o,"#").concat(t),class:"piece"}),a=this.svg.createSVGTransform();a.setTranslate(this.pieceXTranslate,0),n.transform.baseVal.appendItem(a);let h=this.svg.createSVGTransform();return h.setScale(this.scalingY,this.scalingY),n.transform.baseVal.appendItem(h),s}setPieceVisibility(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],s=this.getPieceElement(e);s?t?s.setAttribute("visibility","visible"):s.setAttribute("visibility","hidden"):console.warn("no piece on",e)}getPieceElement(e){if(!e||e.length<2)return console.warn("invalid square",e),null;let t=this.piecesGroup.querySelector("g[data-square='".concat(e,"']"));return t||(console.warn("no piece on",e),null)}enableMoveInput(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;t===S.white?this.chessboard.state.inputWhiteEnabled=!0:(t===S.black||(this.chessboard.state.inputWhiteEnabled=!0),this.chessboard.state.inputBlackEnabled=!0),this.chessboard.state.inputEnabled=!0,this.moveInputCallback=e,this.chessboard.state.invokeExtensionPoints(l.moveInputToggled,{enabled:!0,color:t}),this.visualizeInputState()}disableMoveInput(){this.chessboard.state.inputWhiteEnabled=!1,this.chessboard.state.inputBlackEnabled=!1,this.chessboard.state.inputEnabled=!1,this.moveInputCallback=void 0,this.chessboard.state.invokeExtensionPoints(l.moveInputToggled,{enabled:!1}),this.visualizeInputState()}moveInputStartedCallback(e){let t={chessboard:this.chessboard,type:q.moveInputStarted,square:e,squareFrom:e,piece:this.chessboard.getPiece(e)};this.moveInputCallback&&(t.moveInputCallbackResult=this.moveInputCallback(t));let s=this.chessboard.state.invokeExtensionPoints(l.moveInput,t);return!(!1===s||!t.moveInputCallbackResult)}movingOverSquareCallback(e,t){let s={chessboard:this.chessboard,type:q.movingOverSquare,squareFrom:e,squareTo:t,piece:this.chessboard.getPiece(e)};this.chessboard.state.invokeExtensionPoints(l.moveInput,s)}validateMoveInputCallback(e,t){let s={chessboard:this.chessboard,type:q.validateMoveInput,squareFrom:e,squareTo:t,piece:this.chessboard.getPiece(e)};this.moveInputCallback&&(s.moveInputCallbackResult=this.moveInputCallback(s));let i=this.chessboard.state.invokeExtensionPoints(l.moveInput,s);return!(!1===i||!s.moveInputCallbackResult)}moveInputCanceledCallback(e,t,s){let i={chessboard:this.chessboard,type:q.moveInputCanceled,reason:s,squareFrom:e,squareTo:t};this.chessboard.state.invokeExtensionPoints(l.moveInput,i),this.moveInputCallback&&this.moveInputCallback(i)}visualizeInputState(){this.chessboard.state&&(this.chessboard.state.inputWhiteEnabled||this.chessboard.state.inputBlackEnabled||this.chessboard.state.squareSelectEnabled?this.boardGroup.setAttribute("class","board input-enabled"):this.boardGroup.setAttribute("class","board"))}indexToPoint(e){let t,s;return this.chessboard.state.orientation===S.white?(t=this.borderSize+e%8*this.squareWidth,s=this.borderSize+(7-Math.floor(e/8))*this.squareHeight):(t=this.borderSize+(7-e%8)*this.squareWidth,s=this.borderSize+Math.floor(e/8)*this.squareHeight),{x:t,y:s}}squareToPoint(e){let t=n.squareToIndex(e);return this.indexToPoint(t)}getSpriteUrl(){return this.chessboard.props.assetsUrl+"pieces/"+this.chessboard.props.style.pieces.file}constructor(e){this.chessboard=e,this.moveInput=new y(this,this.moveInputStartedCallback.bind(this),this.movingOverSquareCallback.bind(this),this.validateMoveInputCallback.bind(this),this.moveInputCanceledCallback.bind(this)),e.props.assetsCache&&this.cacheSpriteToDiv("cm-chessboard-sprite",this.getSpriteUrl()),this.context=document.createElement("div"),this.chessboard.context.appendChild(this.context),e.props.responsive&&("undefined"!=typeof ResizeObserver?(this.resizeObserver=new ResizeObserver(()=>{this.handleResize()}),this.resizeObserver.observe(this.chessboard.context)):(this.resizeListener=this.handleResize.bind(this),window.addEventListener("resize",this.resizeListener))),this.pointerDownListener=this.pointerDownHandler.bind(this),this.pointerDownListener=this.pointerDownHandler.bind(this),this.context.addEventListener("mousedown",this.pointerDownListener),this.context.addEventListener("touchstart",this.pointerDownListener),this.createSvgAndGroups(),this.updateMetrics(),this.handleResize(),this.redrawBoard()}}let S={white:"w",black:"b"},q={moveInputStarted:"moveInputStarted",movingOverSquare:"movingOverSquare",validateMoveInput:"validateMoveInput",moveInputCanceled:"moveInputCanceled"},P={primary:"primary",secondary:"secondary"},E={none:"none",thin:"thin",frame:"frame"},x={wp:"wp",wb:"wb",wn:"wn",wr:"wr",wq:"wq",wk:"wk",bp:"bp",bb:"bb",bn:"bn",br:"br",bq:"bq",bk:"bk"},C={svgSprite:"svgSprite"};class I{async setPiece(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this.state.position.clone();return this.state.position.setPiece(e,t),this.state.invokeExtensionPoints(l.positionChanged),this.positionAnimationsQueue.enqueuePositionChange(i,this.state.position.clone(),s)}async movePiece(e,t){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=this.state.position.clone();return this.state.position.movePiece(e,t),this.state.invokeExtensionPoints(l.positionChanged),this.positionAnimationsQueue.enqueuePositionChange(i,this.state.position.clone(),s)}async setPosition(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=this.state.position.clone(),i=new n(e);return s.getFen()!==i.getFen()&&(this.state.position.setFen(e),this.state.invokeExtensionPoints(l.positionChanged)),this.positionAnimationsQueue.enqueuePositionChange(s,this.state.position.clone(),t)}async setOrientation(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=this.state.position.clone();if(this.boardTurning){console.log("setOrientation is only once in queue allowed");return}return this.boardTurning=!0,this.positionAnimationsQueue.enqueueTurnBoard(s,e,t).then(()=>{this.boardTurning=!1,this.state.invokeExtensionPoints(l.boardChanged)})}getPiece(e){return this.state.position.getPiece(e)}getPosition(){return this.state.position.getFen()}getOrientation(){return this.state.orientation}enableMoveInput(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;this.view.enableMoveInput(e,t)}disableMoveInput(){this.view.disableMoveInput()}enableSquareSelect(e){if(this.squareSelectListener){console.warn("squareSelectListener already existing");return}this.squareSelectListener=function(t){let s=t.target.getAttribute("data-square");if("contextmenu"===t.type){t.preventDefault();return}e({mouseEvent:t,chessboard:this,type:2===t.button?P.secondary:P.primary,square:s})},this.context.addEventListener("contextmenu",this.squareSelectListener),this.context.addEventListener("mousedown",this.squareSelectListener),this.context.addEventListener("mouseup",this.squareSelectListener),this.context.addEventListener("touchstart",this.squareSelectListener),this.context.addEventListener("touchend",this.squareSelectListener),this.state.squareSelectEnabled=!0,this.view.visualizeInputState()}disableSquareSelect(){this.context.removeEventListener("contextmenu",this.squareSelectListener),this.context.removeEventListener("mousedown",this.squareSelectListener),this.context.removeEventListener("mouseup",this.squareSelectListener),this.context.removeEventListener("touchstart",this.squareSelectListener),this.context.removeEventListener("touchend",this.squareSelectListener),this.squareSelectListener=void 0,this.state.squareSelectEnabled=!1,this.view.visualizeInputState()}destroy(){this.state.invokeExtensionPoints(l.destroy),this.state.squareSelectEnabled&&this.disableSquareSelect(),this.positionAnimationsQueue.destroy(),this.view.destroy(),this.view=void 0,this.state=void 0}constructor(e,t={}){if(!e)throw Error("container element is "+e);for(let s of(this.context=e,this.id=(Math.random()+1).toString(36).substring(2,8),this.extensions=[],this.props={position:o.empty,orientation:S.white,responsive:!0,language:navigator.language.substring(0,2).toLowerCase(),assetsUrl:"./assets/",assetsCache:!0,style:{cssClass:"default",showCoordinates:!0,borderType:E.none,aspectRatio:1,pieces:{type:C.svgSprite,file:"standard.svg",tileSize:40},animationDuration:300},extensions:[]},f.mergeObjects(this.props,t),"de"!==this.props.language&&"en"!==this.props.language&&(this.props.language="en"),this.state=new a,this.view=new k(this),this.positionAnimationsQueue=new b(this),this.state.orientation=this.props.orientation,this.props.extensions))this.extensions.push(new s.class(this,s.props));this.view.redrawBoard(),this.state.position=new n(this.props.position),this.view.redrawPieces(),this.state.invokeExtensionPoints(l.positionChanged)}}let T={frame:{class:"marker-frame",slice:"markerFrame"},framePrimary:{class:"marker-frame-primary",slice:"markerFrame"},frameDanger:{class:"marker-frame-danger",slice:"markerFrame"},circle:{class:"marker-circle",slice:"markerCircle"},circlePrimary:{class:"marker-circle-primary",slice:"markerCircle"},circleDanger:{class:"marker-circle-danger",slice:"markerCircle"},square:{class:"marker-square",slice:"markerSquare"},dot:{class:"marker-dot",slice:"markerDot",position:"above"},bevel:{class:"marker-bevel",slice:"markerBevel"}};class L extends u{drawAutoMarkers(e){this.removeMarkers(this.autoMarker),(e.type!==q.moveInputStarted||e.moveInputCallbackResult)&&(e.type===q.moveInputStarted||e.type===q.movingOverSquare)&&(e.squareFrom&&this.addMarker(this.autoMarker,e.squareFrom),e.squareTo&&this.addMarker(this.autoMarker,e.squareTo))}onRedrawBoard(){for(;this.markerGroupUp.firstChild;)this.markerGroupUp.removeChild(this.markerGroupUp.firstChild);for(;this.markerGroupDown.firstChild;)this.markerGroupDown.removeChild(this.markerGroupDown.firstChild);this.markers.forEach(e=>{this.drawMarker(e)})}drawMarker(e){let t;(t="above"===e.type.position?c.addElement(this.markerGroupUp,"g"):c.addElement(this.markerGroupDown,"g")).setAttribute("data-square",e.square);let s=this.chessboard.view.squareToPoint(e.square),i=this.chessboard.view.svg.createSVGTransform();i.setTranslate(s.x,s.y),t.transform.baseVal.appendItem(i);let r=this.chessboard.props.assetsCache?"":this.chessboard.props.assetsUrl+"extensions/markers/"+this.props.sprite,o=c.addElement(t,"use",{href:"".concat(r,"#").concat(e.type.slice),class:"marker "+e.type.class}),n=this.chessboard.view.svg.createSVGTransform();return n.setScale(this.chessboard.view.scalingX,this.chessboard.view.scalingY),o.transform.baseVal.appendItem(n),t}addMarker(e,t){if("string"==typeof e||"object"==typeof t){console.error("changed the signature of `addMarker` to `(type, square)` with v5.1.x");return}this.markers.push(new _(t,e)),this.onRedrawBoard()}getMarkers(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if("string"==typeof e||"object"==typeof t){console.error("changed the signature of `getMarkers` to `(type, square)` with v5.1.x");return}let s=[];return this.markers.forEach(i=>{i.matches(t,e)&&s.push(i)}),s}removeMarkers(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if("string"==typeof e||"object"==typeof t){console.error("changed the signature of `removeMarkers` to `(type, square)` with v5.1.x");return}this.markers=this.markers.filter(s=>!s.matches(t,e)),this.onRedrawBoard()}constructor(e,t={}){super(e,t),this.registerExtensionPoint(l.redrawBoard,()=>{this.onRedrawBoard()}),this.props={autoMarkers:T.frame,sprite:"markers.svg"},Object.assign(this.props,t),this.autoMarker={},e.props.assetsCache&&e.view.cacheSpriteToDiv("cm-chessboard-markers",this.chessboard.props.assetsUrl+"extensions/markers/"+this.props.sprite),this.registerMethod("addMarker",this.addMarker),this.registerMethod("getMarkers",this.getMarkers),this.registerMethod("removeMarkers",this.removeMarkers),this.markerGroupDown=c.addElement(e.view.markersLayer,"g",{class:"markers"}),this.markerGroupUp=c.addElement(e.view.markersTopLayer,"g",{class:"markers"}),this.markers=[],this.props.autoMarkers&&(Object.assign(this.autoMarker,this.props.autoMarkers),this.registerExtensionPoint(l.moveInput,e=>{this.drawAutoMarkers(e)}))}}class _{matches(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;if(!t&&!e)return!0;if(t){if(e){if(this.type===t&&e===this.square)return!0}else if(this.type===t)return!0}else if(e===this.square)return!0;return!1}constructor(e,t){this.square=e,this.type=t}}let M={hidden:"hidden",displayRequested:"displayRequested",shown:"shown"};class A extends u{showPromotionDialog(e,t,s){this.state.dialogParams.square=e,this.state.dialogParams.color=t,this.state.callback=s,this.setDisplayState(M.displayRequested)}extensionPointRedrawBoard(){this.redrawDialog()}extensionPointAnimation(e){e.type===d.end&&this.state.displayState===M.displayRequested&&this.setDisplayState(M.shown)}drawPieceButton(e,t){let s=this.chessboard.view.squareWidth,i=this.chessboard.view.squareHeight;c.addElement(this.promotionDialogGroup,"rect",{x:t.x,y:t.y,width:s,height:i,class:"promotion-dialog-button","data-piece":e}),this.chessboard.view.drawPiece(this.promotionDialogGroup,e,t)}redrawDialog(){for(;this.promotionDialogGroup.firstChild;)this.promotionDialogGroup.removeChild(this.promotionDialogGroup.firstChild);if(this.state.displayState===M.shown){let e=this.chessboard.view.squareWidth,t=this.chessboard.view.squareHeight,s=this.chessboard.view.squareToPoint(this.state.dialogParams.square);s.x=s.x+e/2,s.y=s.y+t/2;let i=!1,r=parseInt(this.state.dialogParams.square.charAt(1),10);(this.chessboard.getOrientation()===S.white&&r<5||this.chessboard.getOrientation()===S.black&&r>=5)&&(i=!0);let o=i?-4*t:0,n=s.x+e>this.chessboard.view.width?-e:0;c.addElement(this.promotionDialogGroup,"rect",{x:s.x+n,y:s.y+o,width:e,height:4*t,class:"promotion-dialog"});let a=this.state.dialogParams;i?(this.drawPieceButton(x[a.color+"q"],{x:s.x+n,y:s.y-t}),this.drawPieceButton(x[a.color+"r"],{x:s.x+n,y:s.y-2*t}),this.drawPieceButton(x[a.color+"b"],{x:s.x+n,y:s.y-3*t}),this.drawPieceButton(x[a.color+"n"],{x:s.x+n,y:s.y-4*t})):(this.drawPieceButton(x[a.color+"q"],{x:s.x+n,y:s.y}),this.drawPieceButton(x[a.color+"r"],{x:s.x+n,y:s.y+t}),this.drawPieceButton(x[a.color+"b"],{x:s.x+n,y:s.y+2*t}),this.drawPieceButton(x[a.color+"n"],{x:s.x+n,y:s.y+3*t}))}}promotionDialogOnClickPiece(e){2!==e.button&&(e.target.dataset.piece?(this.state.callback({square:this.state.dialogParams.square,piece:e.target.dataset.piece}),this.setDisplayState(M.hidden)):this.promotionDialogOnCancel(e))}promotionDialogOnCancel(e){this.state.displayState===M.shown&&(e.preventDefault(),this.setDisplayState(M.hidden),this.state.callback(null))}contextMenu(e){e.preventDefault(),this.setDisplayState(M.hidden),this.state.callback(null)}setDisplayState(e){this.state.displayState=e,e===M.shown?(this.clickDelegate=f.delegate(this.chessboard.view.svg,"mousedown","*",this.promotionDialogOnClickPiece.bind(this)),this.contextMenuListener=this.contextMenu.bind(this),this.chessboard.view.svg.addEventListener("contextmenu",this.contextMenuListener)):e===M.hidden&&(this.clickDelegate.remove(),this.chessboard.view.svg.removeEventListener("contextmenu",this.contextMenuListener)),this.redrawDialog()}constructor(e,t={}){super(e,t),this.registerExtensionPoint(l.redrawBoard,this.extensionPointRedrawBoard.bind(this)),this.registerExtensionPoint(l.animation,this.extensionPointAnimation.bind(this)),this.registerMethod("showPromotionDialog",this.showPromotionDialog),this.promotionDialogGroup=c.addElement(e.view.markersTopLayer,"g",{class:"promotion-dialog-group"}),this.state={displayState:M.hidden,callback:void 0,dialogParams:{square:void 0,color:void 0}}}}let D={en:{colors:{w:"w",b:"b"},colors_long:{w:"White",b:"Black"},pieces:{p:"p",n:"n",b:"b",r:"r",q:"q",k:"k"},pieces_long:{p:"Pawn",n:"Knight",b:"Bishop",r:"Rook",q:"Queen",k:"King"}},de:{colors:{w:"w",b:"s"},colors_long:{w:"Wei\xdf",b:"Schwarz"},pieces:{p:"b",n:"s",b:"l",r:"t",q:"d",k:"k"},pieces_long:{p:"Bauer",n:"Springer",b:"L\xe4ufer",r:"Turm",q:"Dame",k:"K\xf6nig"}}};function O(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,i=D[e].pieces_long[t];return s&&(i+=" "+D[e].colors_long[s]),i}let R={de:{chessboard:"Schachbrett",pieces_lists:"Figurenlisten",board_as_table:"Schachbrett als Tabelle",move_piece:"Figur bewegen",from:"Zug von",to:"Zug nach",move:"Zug ausf\xfchren",input_white_enabled:"Eingabe Wei\xdf aktiviert",input_black_enabled:"Eingabe Schwarz aktiviert",input_disabled:"Eingabe deaktiviert",pieces:"Figuren"},en:{chessboard:"Chessboard",pieces_lists:"Pieces lists",board_as_table:"Chessboard as table",move_piece:"Move piece",from:"Move from",to:"Move to",move:"Make move",input_white_enabled:"Input white enabled",input_black_enabled:"Input black enabled",input_disabled:"Input disabled",pieces:"Pieces"}};class B extends u{constructor(e,t){if(super(e,t),this.props={brailleNotationInAlt:!0,movePieceForm:!0,boardAsTable:!0,piecesAsList:!0,visuallyHidden:!0},Object.assign(this.props,t),this.lang=e.props.language,this.tPieces=D[this.lang],this.t=R[this.lang],this.components=[],this.props.movePieceForm||this.props.boardAsTable||this.props.piecesAsList){let e=document.createElement("div");e.classList.add("cm-chessboard-accessibility"),this.chessboard.context.appendChild(e),this.props.visuallyHidden&&e.classList.add("visually-hidden"),this.props.movePieceForm&&this.components.push(new F(e,this)),this.props.boardAsTable&&this.components.push(new N(e,this)),this.props.piecesAsList&&this.components.push(new G(e,this))}this.props.brailleNotationInAlt&&this.components.push(new U(this))}}class U{redraw(){let e=this.extension.chessboard.state.position.getPieces(),t=D[this.extension.lang].colors.w.toUpperCase()+":",s=D[this.extension.lang].colors.b.toUpperCase()+":";for(let i of e){let e="p"===i.name?"":D[this.extension.lang].pieces[i.name].toUpperCase();"w"===i.color?t+=" "+e+i.position:s+=" "+e+i.position}let i="".concat(t,"\n").concat(s);this.extension.chessboard.view.svg.setAttribute("alt",i)}constructor(e){this.extension=e,e.registerExtensionPoint(l.positionChanged,()=>{this.redraw()})}}class F{redraw(){this.inputFrom&&(this.chessboard.state.inputWhiteEnabled||this.chessboard.state.inputBlackEnabled?(this.inputFrom.disabled=!1,this.inputTo.disabled=!1,this.moveButton.disabled=!1):(this.inputFrom.disabled=!0,this.inputTo.disabled=!0,this.moveButton.disabled=!0))}constructor(e,t){this.chessboard=t.chessboard,this.movePieceFormContainer=f.createDomElement('\n<div>\n    <h3 id="hl_form_'.concat(this.chessboard.id,'">').concat(t.t.move_piece,'</h3>\n    <form aria-labelledby="hl_form_').concat(this.chessboard.id,'">\n        <label for="move_piece_input_from_').concat(this.chessboard.id,'">').concat(t.t.from,'</label>\n        <input class="input-from" type="text" size="2" id="move_piece_input_from_').concat(this.chessboard.id,'"/>\n        <label for="move_piece_input_to_').concat(this.chessboard.id,'">').concat(t.t.to,'</label>\n        <input class="input-to" type="text" size="2" id="move_piece_input_to_').concat(this.chessboard.id,'"/>\n        <button type="submit" class="button-move">').concat(t.t.move,"</button>\n    </form>\n</div>")),this.form=this.movePieceFormContainer.querySelector("form"),this.inputFrom=this.form.querySelector(".input-from"),this.inputTo=this.form.querySelector(".input-to"),this.moveButton=this.form.querySelector(".button-move"),this.form.addEventListener("submit",e=>{e.preventDefault(),this.chessboard.view.moveInputCallback({chessboard:this.chessboard,type:q.validateMoveInput,squareFrom:this.inputFrom.value,squareTo:this.inputTo.value})&&this.chessboard.movePiece(this.inputFrom.value,this.inputTo.value,!0).then(()=>{this.inputFrom.value="",this.inputTo.value=""})}),e.appendChild(this.movePieceFormContainer),t.registerExtensionPoint(l.moveInputToggled,()=>{this.redraw()})}}class N{redraw(){let e=this.chessboard.state.position.squares.slice(),t=["a","b","c","d","e","f","g","h"],s=["8","7","6","5","4","3","2","1"];this.chessboard.state.orientation===S.black&&(t.reverse(),s.reverse(),e.reverse());let i='<table aria-labelledby="hl_table_'.concat(this.chessboard.id,'"><tr><th></th>');for(let e of t)i+="<th scope='col'>".concat(e,"</th>");i+="</tr>";for(let t=7;t>=0;t--){i+='<tr><th scope="row">'.concat(s[7-t],"</th>");for(let s=0;s<8;s++){let r,o;let n=e[s%8+8*t];n?(r=n.charAt(0),o=n.charAt(1),i+="<td>".concat(O(this.extension.lang,o,r),"</td>")):i+="<td></td>"}i+="</tr>"}i+="</table>",this.boardAsTable.innerHTML=i}constructor(e,t){this.extension=t,this.chessboard=t.chessboard,this.boardAsTableContainer=f.createDomElement('<div><h3 id="hl_table_'.concat(this.chessboard.id,'">').concat(t.t.board_as_table,'</h3><div class="table"></div></div>')),this.boardAsTable=this.boardAsTableContainer.querySelector(".table"),e.appendChild(this.boardAsTableContainer),t.registerExtensionPoint(l.positionChanged,()=>{this.redraw()}),t.registerExtensionPoint(l.boardChanged,()=>{this.redraw()})}}class G{redraw(){let e=this.chessboard.state.position.getPieces(),t="",s="";for(let i of e)"w"===i.color?t+='<li class="list-inline-item">'.concat(O(this.extension.lang,i.name)," ").concat(i.position,"</li>"):s+='<li class="list-inline-item">'.concat(O(this.extension.lang,i.name)," ").concat(i.position,"</li>");this.piecesList.innerHTML='\n        <h4 id="white_'.concat(this.chessboard.id,'">').concat(this.extension.t.pieces," ").concat(this.extension.tPieces.colors_long.w,'</h4>\n        <ul aria-labelledby="white_').concat(this.chessboard.id,'" class="list-inline">').concat(t,'</ul>\n        <h4 id="black_').concat(this.chessboard.id,'">').concat(this.extension.t.pieces," ").concat(this.extension.tPieces.colors_long.b,'</h4>\n        <ul aria-labelledby="black_').concat(this.chessboard.id,'" class="list-inline">').concat(s,"</ul>")}constructor(e,t){this.extension=t,this.chessboard=t.chessboard,this.piecesListContainer=f.createDomElement('<div><h3 id="hl_lists_'.concat(this.chessboard.id,'">').concat(t.t.pieces_lists,'</h3><div class="list"></div></div>')),this.piecesList=this.piecesListContainer.querySelector(".list"),e.appendChild(this.piecesListContainer),t.registerExtensionPoint(l.positionChanged,()=>{this.redraw()})}}let z="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",j=["1-0","0-1","1/2-1/2","*"],Q={b:[16,32,17,15],w:[-16,-32,-17,-15]},W={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},H=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],K=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],V={p:0,n:1,b:2,r:3,q:4,k:5},Y={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},X={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},$={w:[{square:X.a1,flag:Y.QSIDE_CASTLE},{square:X.h1,flag:Y.KSIDE_CASTLE}],b:[{square:X.a8,flag:Y.QSIDE_CASTLE},{square:X.h8,flag:Y.KSIDE_CASTLE}]};function Z(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function J(e){var t=15&e,s=e>>4;return"abcdefgh".substring(t,t+1)+"87654321".substring(s,s+1)}function ee(e){return e===ei?es:ei}function et(e){return e.replace(/^\s+|\s+$/g,"")}let es="b",ei="w";!function(){for(var e=[],t=X.a8;t<=X.h1;t++){if(136&t){t+=7;continue}e.push(J(t))}}();let er={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},eo=new function(e){var t=Array(128),s={w:-1,b:-1},i=ei,r={w:0,b:0},o=-1,n=0,a=1,h=[],c={},l={};function u(e){void 0===e&&(e=!1),t=Array(128),s={w:-1,b:-1},i=ei,r={w:0,b:0},o=-1,n=0,a=1,h=[],e||(c={}),l={},f(m())}function d(){for(var e=[],t={},s=function(e){(e in l)&&(t[e]=l[e])};h.length>0;)e.push(L());for(s(m());e.length>0;)T(e.pop()),s(m());l=t}function p(e,t){void 0===t&&(t=!1);var s=e.split(/\s+/),h=s[0],c=0;if(!v(e).valid)return!1;u(t);for(var l=0;l<h.length;l++){var d=h.charAt(l);if("/"===d)c+=8;else if(-1!=="0123456789".indexOf(d))c+=parseInt(d,10);else{var p=d<"a"?ei:es;w({type:d.toLowerCase(),color:p},J(c)),c++}}return i=s[1],s[2].indexOf("K")>-1&&(r.w|=Y.KSIDE_CASTLE),s[2].indexOf("Q")>-1&&(r.w|=Y.QSIDE_CASTLE),s[2].indexOf("k")>-1&&(r.b|=Y.KSIDE_CASTLE),s[2].indexOf("q")>-1&&(r.b|=Y.QSIDE_CASTLE),o="-"===s[3]?-1:X[s[3]],n=parseInt(s[4],10),a=parseInt(s[5],10),f(m()),!0}function v(e){var t={0:"No errors.",1:"FEN string must contain six space-delimited fields.",2:"6th field (move number) must be a positive integer.",3:"5th field (half move counter) must be a non-negative integer.",4:"4th field (en-passant square) is invalid.",5:"3rd field (castling availability) is invalid.",6:"2nd field (side to move) is invalid.",7:"1st field (piece positions) does not contain 8 '/'-delimited rows.",8:"1st field (piece positions) is invalid [consecutive numbers].",9:"1st field (piece positions) is invalid [invalid piece].",10:"1st field (piece positions) is invalid [row too large].",11:"Illegal en-passant square"},s=e.split(/\s+/);if(6!==s.length)return{valid:!1,error_number:1,error:t[1]};if(isNaN(parseInt(s[5]))||0>=parseInt(s[5],10))return{valid:!1,error_number:2,error:t[2]};if(isNaN(parseInt(s[4]))||0>parseInt(s[4],10))return{valid:!1,error_number:3,error:t[3]};if(!/^(-|[abcdefgh][36])$/.test(s[3]))return{valid:!1,error_number:4,error:t[4]};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(s[2]))return{valid:!1,error_number:5,error:t[5]};if(!/^(w|b)$/.test(s[1]))return{valid:!1,error_number:6,error:t[6]};var i=s[0].split("/");if(8!==i.length)return{valid:!1,error_number:7,error:t[7]};for(var r=0;r<i.length;r++){for(var o=0,n=!1,a=0;a<i[r].length;a++)if(isNaN(i[r][a])){if(!/^[prnbqkPRNBQK]$/.test(i[r][a]))return{valid:!1,error_number:9,error:t[9]};o+=1,n=!1}else{if(n)return{valid:!1,error_number:8,error:t[8]};o+=parseInt(i[r][a],10),n=!0}if(8!==o)return{valid:!1,error_number:10,error:t[10]}}return"3"==s[3][1]&&"w"==s[1]||"6"==s[3][1]&&"b"==s[1]?{valid:!1,error_number:11,error:t[11]}:{valid:!0,error_number:0,error:t[0]}}function m(){for(var e=0,s="",h=X.a8;h<=X.h1;h++){if(null==t[h])e++;else{e>0&&(s+=e,e=0);var c=t[h].color,l=t[h].type;s+=c===ei?l.toUpperCase():l.toLowerCase()}h+1&136&&(e>0&&(s+=e),h!==X.h1&&(s+="/"),e=0,h+=8)}var u="";return r[ei]&Y.KSIDE_CASTLE&&(u+="K"),r[ei]&Y.QSIDE_CASTLE&&(u+="Q"),r[es]&Y.KSIDE_CASTLE&&(u+="k"),r[es]&Y.QSIDE_CASTLE&&(u+="q"),[s,i,u=u||"-",-1===o?"-":J(o),n,a].join(" ")}function b(e){for(var t=0;t<e.length;t+=2)"string"==typeof e[t]&&"string"==typeof e[t+1]&&(c[e[t]]=e[t+1]);return c}function f(e){h.length>0||(e!==z?(c.SetUp="1",c.FEN=e):(delete c.SetUp,delete c.FEN))}function g(e){var s=t[X[e]];return s?{type:s.type,color:s.color}:null}function w(e,i){if(!("type"in e&&"color"in e)||-1==="pnbrqkPNBRQK".indexOf(e.type.toLowerCase())||!(i in X))return!1;var r=X[i];return("k"!=e.type||-1==s[e.color]||s[e.color]==r)&&(t[r]={type:e.type,color:e.color},"k"===e.type&&(s[e.color]=r),f(m()),!0)}function y(e,t,s,r,o){var n={color:i,from:t,to:s,flags:r,piece:e[t].type};return o&&(n.flags|=Y.PROMOTION,n.promotion=o),e[s]?n.captured=e[s].type:r&Y.EP_CAPTURE&&(n.captured="p"),n}function k(e){function n(e,t,s,i,r){if("p"===e[s].type&&(i>>4==0||i>>4==7))for(var o=["q","r","b","n"],n=0,a=o.length;n<a;n++)t.push(y(e,s,i,r,o[n]));else t.push(y(e,s,i,r))}var a=[],h=i,c=ee(h),l={b:1,w:6},u=X.a8,d=X.h1,p=!1,v=void 0===e||!("legal"in e)||e.legal,m=void 0===e||!("piece"in e)||"string"!=typeof e.piece||e.piece.toLowerCase();if(void 0!==e&&"square"in e){if(!(e.square in X))return[];u=d=X[e.square],p=!0}for(var b=u;b<=d;b++){if(136&b){b+=7;continue}var f=t[b];if(null!=f&&f.color===h){if("p"===f.type&&(!0===m||"p"===m)){var g=b+Q[h][0];if(null==t[g]){n(t,a,b,g,Y.NORMAL);var g=b+Q[h][1];l[h]===b>>4&&null==t[g]&&n(t,a,b,g,Y.BIG_PAWN)}for(w=2;w<4;w++){var g=b+Q[h][w];136&g||(null!=t[g]&&t[g].color===c?n(t,a,b,g,Y.CAPTURE):g===o&&n(t,a,b,o,Y.EP_CAPTURE))}}else if(!0===m||m===f.type)for(var w=0,k=W[f.type].length;w<k;w++)for(var S=W[f.type][w],g=b;!(136&(g+=S));){if(null==t[g])n(t,a,b,g,Y.NORMAL);else{if(t[g].color===h)break;n(t,a,b,g,Y.CAPTURE);break}if("n"===f.type||"k"===f.type)break}}}if((!0===m||"k"===m)&&(!p||d===s[h])){if(r[h]&Y.KSIDE_CASTLE){var E=s[h],x=E+2;null!=t[E+1]||null!=t[x]||q(c,s[h])||q(c,E+1)||q(c,x)||n(t,a,s[h],x,Y.KSIDE_CASTLE)}if(r[h]&Y.QSIDE_CASTLE){var E=s[h],x=E-2;null!=t[E-1]||null!=t[E-2]||null!=t[E-3]||q(c,s[h])||q(c,E-1)||q(c,x)||n(t,a,s[h],x,Y.QSIDE_CASTLE)}}if(!v)return a;for(var C=[],b=0,k=a.length;b<k;b++)T(a[b]),P(h)||C.push(a[b]),L();return C}function S(e,t){var s="";if(e.flags&Y.KSIDE_CASTLE)s="O-O";else if(e.flags&Y.QSIDE_CASTLE)s="O-O-O";else{if("p"!==e.piece){var r=function(e,t){for(var s=e.from,i=e.to,r=e.piece,o=0,n=0,a=0,h=0,c=t.length;h<c;h++){var l=t[h].from,u=t[h].to;r===t[h].piece&&s!==l&&i===u&&(o++,s>>4==l>>4&&n++,(15&s)==(15&l)&&a++)}return o>0?n>0&&a>0?J(s):a>0?J(s).charAt(1):J(s).charAt(0):""}(e,t);s+=e.piece.toUpperCase()+r}e.flags&(Y.CAPTURE|Y.EP_CAPTURE)&&("p"===e.piece&&(s+=J(e.from)[0]),s+="x"),s+=J(e.to),e.flags&Y.PROMOTION&&(s+="="+e.promotion.toUpperCase())}return T(e),P(i)&&(E()?s+="#":s+="+"),L(),s}function q(e,s){for(var i=X.a8;i<=X.h1;i++){if(136&i){i+=7;continue}if(null!=t[i]&&t[i].color===e){var r=t[i],o=i-s,n=o+119;if(H[n]&1<<V[r.type]){if("p"===r.type){if(o>0){if(r.color===ei)return!0}else if(r.color===es)return!0;continue}if("n"===r.type||"k"===r.type)return!0;for(var a=K[n],h=i+a,c=!1;h!==s;){if(null!=t[h]){c=!0;break}h+=a}if(!c)return!0}}}return!1}function P(e){return q(ee(e),s[e])}function E(){return P(i)&&0===k().length}function x(){return!P(i)&&0===k().length}function C(){for(var e={},s=[],i=0,r=0,o=X.a8;o<=X.h1;o++){if(r=(r+1)%2,136&o){o+=7;continue}var n=t[o];n&&(e[n.type]=n.type in e?e[n.type]+1:1,"b"===n.type&&s.push(r),i++)}if(2===i||3===i&&(1===e.b||1===e.n))return!0;if(i===e.b+2){for(var a=0,h=s.length,o=0;o<h;o++)a+=s[o];if(0===a||a===h)return!0}return!1}function I(){for(var e=[],t={},s=!1;;){var i=L();if(!i)break;e.push(i)}for(;;){var r=m().split(" ").slice(0,4).join(" ");if(t[r]=r in t?t[r]+1:1,t[r]>=3&&(s=!0),!e.length)break;T(e.pop())}return s}function T(e){var c=i,l=ee(c);if(h.push({move:e,kings:{b:s.b,w:s.w},turn:i,castling:{b:r.b,w:r.w},ep_square:o,half_moves:n,move_number:a}),t[e.to]=t[e.from],t[e.from]=null,e.flags&Y.EP_CAPTURE&&(i===es?t[e.to-16]=null:t[e.to+16]=null),e.flags&Y.PROMOTION&&(t[e.to]={type:e.promotion,color:c}),"k"===t[e.to].type){if(s[t[e.to].color]=e.to,e.flags&Y.KSIDE_CASTLE){var u=e.to-1,d=e.to+1;t[u]=t[d],t[d]=null}else if(e.flags&Y.QSIDE_CASTLE){var u=e.to+1,d=e.to-2;t[u]=t[d],t[d]=null}r[c]=""}if(r[c]){for(var p=0,v=$[c].length;p<v;p++)if(e.from===$[c][p].square&&r[c]&$[c][p].flag){r[c]^=$[c][p].flag;break}}if(r[l]){for(var p=0,v=$[l].length;p<v;p++)if(e.to===$[l][p].square&&r[l]&$[l][p].flag){r[l]^=$[l][p].flag;break}}o=e.flags&Y.BIG_PAWN?"b"===i?e.to-16:e.to+16:-1,"p"===e.piece?n=0:e.flags&(Y.CAPTURE|Y.EP_CAPTURE)?n=0:n++,i===es&&a++,i=ee(i)}function L(){var e,c,l=h.pop();if(null==l)return null;var u=l.move;s=l.kings,i=l.turn,r=l.castling,o=l.ep_square,n=l.half_moves,a=l.move_number;var d=i,p=ee(i);return t[u.from]=t[u.to],t[u.from].type=u.piece,t[u.to]=null,u.flags&Y.CAPTURE?t[u.to]={type:u.captured,color:p}:u.flags&Y.EP_CAPTURE&&(t[d===es?u.to-16:u.to+16]={type:"p",color:p}),u.flags&(Y.KSIDE_CASTLE|Y.QSIDE_CASTLE)&&(u.flags&Y.KSIDE_CASTLE?(e=u.to+1,c=u.to-1):u.flags&Y.QSIDE_CASTLE&&(e=u.to-2,c=u.to+1),t[e]=t[c],t[c]=null),u}function _(e,t){for(var s=Z(e),i=0;i<2;i++){if(1==i){if(!t)return null;var r=!1,o=s.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/);if(o){var n=o[1],a=o[2],h=o[3],c=o[4];1==a.length&&(r=!0)}else{var o=s.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/);if(o){var n=o[1],a=o[2],h=o[3],c=o[4];if(1==a.length)var r=!0}}}for(var l=function(e){var t=e.charAt(0);if(t>="a"&&t<="h"){if(e.match(/[a-h]\d.*[a-h]\d/))return;return"p"}return"o"===(t=t.toLowerCase())?"k":t}(s),u=k({legal:!0,piece:n||l}),d=0,p=u.length;d<p;d++)switch(i){case 0:if(s===Z(S(u[d],u)))return u[d];break;case 1:if(o){if((!n||n.toLowerCase()==u[d].piece)&&X[a]==u[d].from&&X[h]==u[d].to&&(!c||c.toLowerCase()==u[d].promotion))return u[d];if(r){var v=J(u[d].from);if((!n||n.toLowerCase()==u[d].piece)&&X[h]==u[d].to&&(a==v[0]||a==v[1])&&(!c||c.toLowerCase()==u[d].promotion))return u[d]}}}}return null}function M(e){var t=function e(t){var s=t instanceof Array?[]:{};for(var i in t)"object"==typeof i?s[i]=e(t[i]):s[i]=t[i];return s}(e);t.san=S(t,k({legal:!0})),t.to=J(t.to),t.from=J(t.from);var s="";for(var i in Y)Y[i]&t.flags&&(s+=er[i]);return t.flags=s,t}return void 0===e?p(z):p(e),{load:function(e){return p(e)},reset:function(){p(z)},moves:function(e){for(var t=k(e),s=[],i=0,r=t.length;i<r;i++)void 0!==e&&"verbose"in e&&e.verbose?s.push(M(t[i])):s.push(S(t[i],k({legal:!0})));return s},in_check:function(){return P(i)},in_checkmate:function(){return E()},in_stalemate:function(){return x()},in_draw:function(){return n>=100||x()||C()||I()},insufficient_material:function(){return C()},in_threefold_repetition:function(){return I()},game_over:function(){return n>=100||E()||x()||C()||I()},validate_fen:function(e){return v(e)},fen:function(){return m()},board:function(){for(var e=[],s=[],i=X.a8;i<=X.h1;i++)null==t[i]?s.push(null):s.push({square:J(i),type:t[i].type,color:t[i].color}),i+1&136&&(e.push(s),s=[],i+=8);return e},pgn:function(e){var t="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\n",s="object"==typeof e&&"number"==typeof e.max_width?e.max_width:0,i=[],r=!1;for(var o in c)i.push("["+o+' "'+c[o]+'"]'+t),r=!0;r&&h.length&&i.push(t);for(var n=function(e){var t=l[m()];if(void 0!==t){var s=e.length>0?" ":"";e="".concat(e).concat(s,"{").concat(t,"}")}return e},u=[];h.length>0;)u.push(L());var d=[],p="";for(0===u.length&&d.push(n(""));u.length>0;){p=n(p);var v=u.pop();if(h.length||"b"!==v.color)"w"===v.color&&(p.length&&d.push(p),p=a+".");else{let e="".concat(a,". ...");p=p?"".concat(p," ").concat(e):e}p=p+" "+S(v,k({legal:!0})),T(v)}if(p.length&&d.push(n(p)),void 0!==c.Result&&d.push(c.Result),0===s)return i.join("")+d.join(" ");for(var b=function(){return i.length>0&&" "===i[i.length-1]&&(i.pop(),!0)},f=0,o=0;o<d.length;o++){if(f+d[o].length>s&&d[o].includes("{")){f=function(e,r){for(var o of r.split(" "))if(o){if(e+o.length>s){for(;b();)e--;i.push(t),e=0}i.push(o),e+=o.length,i.push(" "),e++}return b()&&e--,e}(f,d[o]);continue}f+d[o].length>s&&0!==o?(" "===i[i.length-1]&&i.pop(),i.push(t),f=0):0!==o&&(i.push(" "),f++),i.push(d[o]),f+=d[o].length}return i.join("")},load_pgn:function(e,t){var s=void 0!==t&&"sloppy"in t&&t.sloppy;function i(e){return e.replace(/\\/g,"\\")}e=e.trim();var r="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\r?\n",o=RegExp("^(\\[((?:"+i(r)+")|.)*\\])(?:\\s*"+i(r)+"){2}"),n=o.test(e)?o.exec(e)[1]:"";p(z);var a=function(e,t){for(var s="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\r?\n",r={},o=e.split(new RegExp(i(s))),n="",a="",h=0;h<o.length;h++){var c=/^\s*\[([A-Za-z]+)\s*"(.*)"\s*\]\s*$/;n=o[h].replace(c,"$1"),a=o[h].replace(c,"$2"),et(n).length>0&&(r[n]=a)}return r}(n,t),h="";for(var u in a)"fen"===u.toLowerCase()&&(h=a[u]),b([u,a[u]]);if(s){if(h&&!p(h,!0))return!1}else if("1"===a.SetUp&&!("FEN"in a&&p(a.FEN,!0)))return!1;for(var d=function(e){return e=e.replace(RegExp(i(r),"g")," "),"{".concat(Array.from(e.slice(1,e.length-1)).map(function(e){return 128>e.charCodeAt(0)?e.charCodeAt(0).toString(16):encodeURIComponent(e).replace(/\%/g,"").toLowerCase()}).join(""),"}")},v=e.replace(n,"").replace(RegExp("({[^}]*})+?|;([^".concat(i(r),"]*)"),"g"),function(e,t,s){return void 0!==t?d(t):" "+d("{".concat(s.slice(1),"}"))}).replace(RegExp(i(r),"g")," "),f=/(\([^\(\)]+\))+?/g;f.test(v);)v=v.replace(f,"");var g=et(v=(v=(v=v.replace(/\d+\.(\.\.)?/g,"")).replace(/\.\.\./g,"")).replace(/\$\d+/g,"")).split(new RegExp(/\s+/));g=g.join(",").replace(/,,+/g,",").split(",");for(var w="",y="",k=0;k<g.length;k++){var S=function(e){if(e.startsWith("{")&&e.endsWith("}")){var t;return 0==(t=e.slice(1,e.length-1)).length?"":decodeURIComponent("%"+t.match(/.{1,2}/g).join("%"))}}(g[k]);if(void 0!==S){l[m()]=S;continue}if(null==(w=_(g[k],s))){if(!(j.indexOf(g[k])>-1))return!1;y=g[k]}else y="",T(w)}return y&&Object.keys(c).length&&!c.Result&&b(["Result",y]),!0},header:function(){return b(arguments)},turn:function(){return i},move:function(e,t){var s=void 0!==t&&"sloppy"in t&&t.sloppy,i=null;if("string"==typeof e)i=_(e,s);else if("object"==typeof e){for(var r=k(),o=0,n=r.length;o<n;o++)if(e.from===J(r[o].from)&&e.to===J(r[o].to)&&(!("promotion"in r[o])||e.promotion===r[o].promotion)){i=r[o];break}}if(!i)return null;var a=M(i);return T(i),a},undo:function(){var e=L();return e?M(e):null},clear:function(){return u()},put:function(e,t){return w(e,t)},get:function(e){return g(e)},ascii(){for(var e="   +------------------------+\n",s=X.a8;s<=X.h1;s++){if(0==(15&s)&&(e+=" "+"87654321"[s>>4]+" |"),null==t[s])e+=" . ";else{var i=t[s].type;e+=" "+(t[s].color===ei?i.toUpperCase():i.toLowerCase())+" "}s+1&136&&(e+="|\n",s+=8)}return e+"   +------------------------+\n     a  b  c  d  e  f  g  h"},remove:function(e){var i;return i=g(e),t[X[e]]=null,i&&"k"===i.type&&(s[i.color]=-1),f(m()),i},perft:function(e){return function e(t){for(var s=k({legal:!1}),r=0,o=i,n=0,a=s.length;n<a;n++)T(s[n]),!P(o)&&(t-1>0?r+=e(t-1):r++),L();return r}(e)},square_color:function(e){if(e in X){var t=X[e];return((t>>4)+(15&t))%2==0?"light":"dark"}return null},history:function(e){for(var t=[],s=[],i=void 0!==e&&("verbose"in e)&&e.verbose;h.length>0;)t.push(L());for(;t.length>0;){var r=t.pop();i?s.push(M(r)):s.push(S(r,k({legal:!0}))),T(r)}return s},get_comment:function(){return l[m()]},set_comment:function(e){l[m()]=e.replace("{","[").replace("}","]")},delete_comment:function(){var e=l[m()];return delete l[m()],e},get_comments:function(){return d(),Object.keys(l).map(function(e){return{fen:e,comment:l[e]}})},delete_comments:function(){return d(),Object.keys(l).map(function(e){var t=l[e];return delete l[e],{fen:e,comment:t}})}}};function en(e){let t=eo.moves({verbose:!0});if(t.length>0){let s=Math.floor(Math.random()*t.length),i=t[s];setTimeout(()=>{eo.move({from:i.from,to:i.to}),e.setPosition(eo.fen(),!0),e.enableMoveInput(ea,S.white)},500)}}function ea(e){if(e.chessboard.removeMarkers(T.dot),e.chessboard.removeMarkers(T.bevel),e.type===q.moveInputStarted){let t=eo.moves({square:e.square,verbose:!0});for(let s of t)s.promotion&&"q"!==s.promotion||(e.chessboard.getPiece(s.to)?e.chessboard.addMarker(T.bevel,s.to):e.chessboard.addMarker(T.dot,s.to));return t.length>0}if(e.type===q.validateMoveInput){let t={from:e.squareFrom,to:e.squareTo,promotion:e.promotion},s=eo.move(t);if(s)e.chessboard.disableMoveInput(),this.chessboard.state.moveInputProcess.then(()=>{this.chessboard.setPosition(eo.fen(),!0).then(()=>{en(e.chessboard)})});else for(let t of eo.moves({square:e.squareFrom,verbose:!0}))if(t.promotion&&t.to===e.squareTo)return e.chessboard.showPromotionDialog(e.squareTo,S.white,t=>{console.log("promotion result",t),t?(eo.move({from:e.squareFrom,to:e.squareTo,promotion:t.piece.charAt(1)}),e.chessboard.setPosition(eo.fen(),!0),en(e.chessboard)):(e.chessboard.setPosition(eo.fen(),!0),e.chessboard.enableMoveInput(ea,S.white))}),!0;return s}}function eh(){return(0,r.useEffect)(()=>{!function(e){let t=new I(document.getElementById(e),{position:eo.fen(),assetsUrl:"/assets/chess/",style:{borderType:E.thin,pieces:{file:"staunty.svg"}},orientation:S.white,extensions:[{class:L,props:{autoMarkers:T.square}},{class:A},{class:B,props:{visuallyHidden:!0}}]});t.enableMoveInput(ea,S.white)}("board")},[]),(0,i.jsx)("section",{children:(0,i.jsxs)("div",{className:"chess-container",children:[(0,i.jsx)("div",{class:"board",id:"board"}),(0,i.jsx)("div",{id:"output"})]})})}}},function(e){e.O(0,[774,888,179],function(){return e(e.s=1560)}),_N_E=e.O()}]);